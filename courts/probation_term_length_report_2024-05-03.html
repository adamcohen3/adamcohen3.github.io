<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adam S. Cohen">
<meta name="dcterms.date" content="2024-05-01">

<title>Probation Term Length Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="probation_term_length_report_2024-05-03_files/libs/clipboard/clipboard.min.js"></script>
<script src="probation_term_length_report_2024-05-03_files/libs/quarto-html/quarto.js"></script>
<script src="probation_term_length_report_2024-05-03_files/libs/quarto-html/popper.min.js"></script>
<script src="probation_term_length_report_2024-05-03_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="probation_term_length_report_2024-05-03_files/libs/quarto-html/anchor.min.js"></script>
<link href="probation_term_length_report_2024-05-03_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="probation_term_length_report_2024-05-03_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="probation_term_length_report_2024-05-03_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="probation_term_length_report_2024-05-03_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="probation_term_length_report_2024-05-03_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">1</span> Background</a></li>
  <li><a href="#probation-length-before-and-after-2018" id="toc-probation-length-before-and-after-2018" class="nav-link" data-scroll-target="#probation-length-before-and-after-2018"><span class="header-section-number">2</span> Probation length before and after 2018</a></li>
  <li><a href="#issue-1-lag-in-data-entry" id="toc-issue-1-lag-in-data-entry" class="nav-link" data-scroll-target="#issue-1-lag-in-data-entry"><span class="header-section-number">3</span> Issue 1: Lag in data entry</a>
  <ul class="collapse">
  <li><a href="#problem-data-used-in-pew-report-is-skewed-because-of-data-entry-lag" id="toc-problem-data-used-in-pew-report-is-skewed-because-of-data-entry-lag" class="nav-link" data-scroll-target="#problem-data-used-in-pew-report-is-skewed-because-of-data-entry-lag"><span class="header-section-number">3.1</span> Problem: Data used in Pew report is skewed because of data entry lag</a></li>
  <li><a href="#solution-using-data-when-it-is-stable-and-relatively-complete" id="toc-solution-using-data-when-it-is-stable-and-relatively-complete" class="nav-link" data-scroll-target="#solution-using-data-when-it-is-stable-and-relatively-complete"><span class="header-section-number">3.2</span> Solution: Using data when it is stable and relatively complete</a></li>
  </ul></li>
  <li><a href="#issue-2-calculating-probation-length-indirectly" id="toc-issue-2-calculating-probation-length-indirectly" class="nav-link" data-scroll-target="#issue-2-calculating-probation-length-indirectly"><span class="header-section-number">4</span> Issue 2: Calculating probation length indirectly</a>
  <ul class="collapse">
  <li><a href="#problem-the-pew-report-estimates-probation-term-length-indirectly-but-the-validity-of-the-method-depends-on-assumptions-that-may-have-been-violated" id="toc-problem-the-pew-report-estimates-probation-term-length-indirectly-but-the-validity-of-the-method-depends-on-assumptions-that-may-have-been-violated" class="nav-link" data-scroll-target="#problem-the-pew-report-estimates-probation-term-length-indirectly-but-the-validity-of-the-method-depends-on-assumptions-that-may-have-been-violated"><span class="header-section-number">4.1</span> Problem: The Pew report estimates probation term length indirectly but the validity of the method depends on assumptions that may have been violated</a></li>
  <li><a href="#solution-using-a-direct-method-to-estimate-probation-term-length" id="toc-solution-using-a-direct-method-to-estimate-probation-term-length" class="nav-link" data-scroll-target="#solution-using-a-direct-method-to-estimate-probation-term-length"><span class="header-section-number">4.2</span> Solution: Using a direct method to estimate probation term length</a></li>
  </ul></li>
  <li><a href="#issue-3-aggregating-felony-and-non-felony-probationers" id="toc-issue-3-aggregating-felony-and-non-felony-probationers" class="nav-link" data-scroll-target="#issue-3-aggregating-felony-and-non-felony-probationers"><span class="header-section-number">5</span> Issue 3: Aggregating felony and non-felony probationers</a>
  <ul class="collapse">
  <li><a href="#problem-the-pew-report-aggregates-felony-and-non-felony-probationers-but-the-mean-of-data-containing-two-mostly-non-overlapping-groups-is-often-meaningless" id="toc-problem-the-pew-report-aggregates-felony-and-non-felony-probationers-but-the-mean-of-data-containing-two-mostly-non-overlapping-groups-is-often-meaningless" class="nav-link" data-scroll-target="#problem-the-pew-report-aggregates-felony-and-non-felony-probationers-but-the-mean-of-data-containing-two-mostly-non-overlapping-groups-is-often-meaningless"><span class="header-section-number">5.1</span> Problem: The Pew report aggregates felony and non-felony probationers but the mean of data containing two (mostly) non-overlapping groups is often meaningless</a></li>
  <li><a href="#solution-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data" id="toc-solution-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data" class="nav-link" data-scroll-target="#solution-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data"><span class="header-section-number">5.2</span> Solution: Disaggregating felony and non-felony using a direct method and stable data</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary"><span class="header-section-number">6</span> Summary</a>
  <ul class="collapse">
  <li><a href="#outstanding-issues" id="toc-outstanding-issues" class="nav-link" data-scroll-target="#outstanding-issues"><span class="header-section-number">6.1</span> Outstanding issues</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Probation Term Length Report</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Adam S. Cohen </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  
<div>
  <div class="abstract">
    <div class="abstract-title">Abstract</div>
    <p>How long are probation term lengths in Hawaii? <a href="https://www.pewtrusts.org/en/research-and-analysis/reports/2020/12/states-can-shorten-probation-and-protect-public-safety">Past estimates</a> report 58.9 months, the longest of any state in the US. But this analysis was limited to a single year, relied on an “indirect” approximation method to compute probation term length, and suffered from at least one serious data quality issue that likely inflated estimates. To address these limitations, a more complete profile of probation term length is provided by looking over a 12 year window while addressing previous data quality issues. The new estimates converge when using the “indirect” method and a direct approach that relies on case-level data. Even when these limitations are addressed, estimates of probation term length are still misleading as they lump felony and non-felony cases, which are mostly non-overlapping subpopulations. To provide a more conceptually meaningful estimate of probation term length, estimates are disaggregated by offense degree.</p>
  </div>
</div>

</header>

<section id="background" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="background"><span class="header-section-number">1</span> Background</h2>
<p>In a state-by-state analysis of probation length across the US, The Pew Charitable Trusts <a href="https://www.pewtrusts.org/en/research-and-analysis/reports/2020/12/states-can-shorten-probation-and-protect-public-safety">reported</a> that, in 2018, the state of Hawaii had the longest average probation lengths in the country at 58.9 months (<a href="https://www.pewtrusts.org/en/research-and-analysis/reports/2020/12/states-can-shorten-probation-and-protect-public-safety">The Pew Charitable Trusts, 2020</a>). <br> <br></p>
<div id="fig-pew1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<iframe width="650" height="557" src="Shorten_Probation_and_Public_Safety_Report_650px_Figure1.png">
</iframe>
<figcaption class="figure-caption">Figure&nbsp;1: The 2020 Pew Report on Average Probation Lengths</figcaption>
</figure>
</div>
<p><br> Notably, the analysis focused on a single year, and not on the larger pattern across time that could reveal whether 2018 was representative of probation length in general or whether there has been change over time.</p>
</section>
<section id="probation-length-before-and-after-2018" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="probation-length-before-and-after-2018"><span class="header-section-number">2</span> Probation length before and after 2018</h2>
<p>To provide a more complete picture of probation length in Hawaii, we analyzed data prior to 2018 and after 2018 using the same data source and method as Pew. Pew relied on data from the Bureau of Justice Statistics <a href="https://bjs.ojp.gov/data-collection/annual-probation-survey-and-annual-parole-survey">Annual Probation Survey</a> and an <em>indirect method</em> to estimate probation length (<a href="https://link.springer.com/article/10.1007/s10940-007-9037-z">Patterson &amp; Preston, 2008</a>).</p>
<p>It is indirect because it does not use case-level data to calculate probation term length for individual probationers and then average over them, instead relying on descriptive statistics for the entire group of probationers and using those to approximate probation term length. This method has been shown to produce valid estimates so long as certain assumptions are met (<a href="https://link.springer.com/article/10.1007/s10940-007-9037-z">Patterson &amp; Preston, 2008</a>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand to learn more about the <em>indirect method</em> used by Pew
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Estimating probation length using an indirect method as described in <a href="https://link.springer.com/article/10.1007/s10940-007-9037-z">Patterson and Preston (2008)</a>) depends on only three variables: the size of the probation population at the beginning and end of the year, along with the number of exits. These three variables are used to calculate an “exit rate.”</p>
<p><span class="math display">\[exit.rate = \frac{exits}{\frac{1}{2}*(population_{begin} + population_{end})}\]</span> The inverse of this exit rate is the estimated average probation length.</p>
<p><span class="math display">\[probation.length = \frac{1}{exit.rate}\]</span></p>
<p>To pump your intuition for why this works, consider a case where the probation population at the beginning of the year is 10,000 and by the end of the year it remains at 10,000. <br><br> First, imagine a situation where there are 10,000 exits during the year. Then, <span class="math inline">\(exit.rate = \frac{10,000}{\frac{1}{2}*(10,000+10,000)}\)</span>, which becomes <span class="math inline">\(exit.rate = 1\)</span>. Since, <span class="math inline">\(probation.length = \frac{1}{exit.rate}\)</span>, the estimated probation length is 1 year. One way to think about this is that it’s as if all 10,000 probationers from the beginning of the year came off of probation, having completed a full year at some point during the year, and 10,000 new probationers with terms of 1 year came on. <br><br> But now imagine the same situation except there are 5,000 exits. Then <span class="math inline">\(exit.rate = \frac{5,000}{\frac{1}{2}*(10,000+10,000)}\)</span>, which becomes <span class="math inline">\(exit.rate = \frac{1}{2}\)</span>. Therefore, <span class="math inline">\(probation.length = \frac{1}{1/2}\)</span>, which is 2 years. One way to think about this is that it’s as if half of the 10,000 probationers from the beginning of the year came off, having completed their second year of probation, the other half has entered their second year, and another 5,000 new probationers with terms of 2 years came on. <br><br> Or imagine the same situation except there are 20,000 exits. Then <span class="math inline">\(exit.rate = \frac{20,000}{\frac{1}{2}*(10,000+10,000)}\)</span>, which becomes <span class="math inline">\(exit.rate = 2\)</span>. Therefore, <span class="math inline">\(probation.length = \frac{1}{2}\)</span>, which is 0.5 years. One way to think about this is that it’s as if all 10,000 probationers from the beginning of the year came off of probation, having completed a 1/2 year at some point during the year, another 10,000 new probationers with terms of 1/2 year came on earlier in the year and came off before the end of the year, and another 10,000 new probationers with terms of 1/2 year came on at some point later in the year.</p>
</div>
</div>
</div>
<p>Pew reported data for 2000 and 2018 (see <span style="color:blue;">blue</span> dots in <a href="#fig-pew2">Figure&nbsp;2</a>). Here we fill in some of the gaps by providing data from the BJS Annual Probation Survey for 2012-2017 and 2019-2023.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#import data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>bjs_prob_HI_filler <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2001</span><span class="sc">:</span><span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pop_begin =</span> <span class="fu">c</span>(<span class="dv">15707</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">22316</span>, <span class="dv">22211</span>, <span class="dv">21576</span>, <span class="dv">20931</span>, <span class="dv">20912</span>, <span class="dv">20516</span>, <span class="dv">19830</span>, <span class="dv">20196</span>, <span class="dv">19619</span>, <span class="dv">17291</span>, <span class="dv">17746</span>, <span class="dv">14341</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pop_end =</span> <span class="fu">c</span>(<span class="dv">15525</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">22211</span>, <span class="dv">21576</span>, <span class="dv">20931</span>, <span class="dv">20912</span>, <span class="dv">20516</span>,  <span class="dv">19830</span>, <span class="dv">20196</span>, <span class="dv">19619</span>, <span class="dv">17291</span>, <span class="dv">17746</span>, <span class="dv">14341</span>, <span class="dv">14538</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">exits =</span> <span class="fu">c</span>(<span class="dv">6102</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">6297</span>, <span class="dv">5592</span>, <span class="dv">5303</span>, <span class="dv">5061</span>, <span class="dv">4796</span>,  <span class="dv">4557</span>, <span class="dv">4077</span>, <span class="dv">4225</span>, <span class="dv">3857</span>, <span class="dv">3981</span>, <span class="dv">5634</span>, <span class="dv">4028</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate exit rate and est prob length</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>bjs_prob_HI_stats_filler <span class="ot">&lt;-</span> bjs_prob_HI_filler <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exit_rate =</span> exits<span class="sc">/</span>((pop_begin <span class="sc">+</span> pop_end)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_mo =</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">1</span><span class="sc">/</span>exit_rate,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_yr =</span> <span class="dv">1</span><span class="sc">/</span>exit_rate,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"CE_BJS_survey"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#plot data</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bjs_prob_HI_stats_filler, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo)) <span class="sc">+</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(year)), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(aes(label = paste0(janitor::round_half_up(est_prob_term_length_mo, digits = 1))), vjust = 0, nudge_y = 1, color = "gray") +</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_continuous(NULL, limits = c(2012, 2021)) +</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Estimated Probation Term Length (months)"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_hline(yintercept = 22.4, color = "red", linetype = 2, size = 1) +</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">22.4</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"National Avg, 2018</span><span class="sc">\n</span><span class="st">22.4 months"</span>) <span class="sc">+</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 2017, y = 58.9, hjust = 0, vjust = -.5, label = "HI, 2018\n58.9 months") +</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2017</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">label =</span> <span class="st">"58.9 months"</span>) <span class="sc">+</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2000</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 1999, y = 30.7, hjust = 0, vjust = -.5, label = "HI, 2000\n30.7 months") +</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1999</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">label =</span> <span class="st">"30.7 months"</span>) <span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hawaii Probation Term Lengths Across Time"</span>) <span class="sc">+</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-pew2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="probation_term_length_report_2024-05-03_files/figure-html/fig-pew2-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Probation length by year</figcaption>
</figure>
</div>
</div>
</div>
<p>The estimated probation length in 2018 appears to represent a peak when using the data that was provided to BJS.</p>
</section>
<section id="issue-1-lag-in-data-entry" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="issue-1-lag-in-data-entry"><span class="header-section-number">3</span> Issue 1: Lag in data entry</h2>
<section id="problem-data-used-in-pew-report-is-skewed-because-of-data-entry-lag" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="problem-data-used-in-pew-report-is-skewed-because-of-data-entry-lag"><span class="header-section-number">3.1</span> Problem: Data used in Pew report is skewed because of data entry lag</h3>
<p>As of April 2024, there appears to be significant data entry lag in Caseload Explorer, the case management system used by probation at the Hawaii State Judiciary. Data entry does not appear to be “stable” until 12-24 months after the end of a calendar year.</p>
<p>This was discovered when trying to re-analyze probation term lengths and noticing that the number of exits, or terminations, in a given year depends on when the analysis was run. When it is run a few months after the end of a calendar year, as it is typically done for the BJS Annual Probation Survey, there are typically 1000 to 2000 fewer terminations compared to when it is run 24 or more months later (not including 2022 or 2023, as not enough time has passed).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand to learn more about data entry lag in Caseload Explorer
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>UNDER CONSTRUCTION!</p>
</div>
</div>
</div>
</section>
<section id="solution-using-data-when-it-is-stable-and-relatively-complete" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="solution-using-data-when-it-is-stable-and-relatively-complete"><span class="header-section-number">3.2</span> Solution: Using data when it is stable and relatively complete</h3>
<p>To address this, the indirect method was used again but with data extracted from Caseload Explorer in April 2024. For all years except 2022 and 2023, this allowed at least 24 months after the close of the year for probation officers to complete data entry.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages -----------------------------------------------------------</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="do">##2024 DATA PULLS: exit rate and prob term length calculation --------</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>prob_HI_update <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"Stats01_run_in_2024_CY2012-CY2023_2024-04-29.xlsx"</span>, <span class="at">col_types =</span> <span class="st">"numeric"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>prob_HI_update_stats <span class="ot">&lt;-</span> prob_HI_update <span class="sc">%&gt;%</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exit_rate =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(pop_begin), exits<span class="sc">/</span>((pop_begin <span class="sc">+</span> pop_end)<span class="sc">/</span><span class="dv">2</span>), <span class="cn">NA</span>),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_mo =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(pop_begin), <span class="dv">12</span><span class="sc">*</span><span class="dv">1</span><span class="sc">/</span>exit_rate, <span class="cn">NA</span>),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_yr =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(pop_begin), <span class="dv">1</span><span class="sc">/</span>exit_rate, <span class="cn">NA</span>),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"CE_2024"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(prob_HI_update_stats, paste0("probation_term_length_results_Pew_method_CY12-CY23_", Sys.Date(), ".csv"), row.names = F)</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># merge BJS old and new CE datasets ---------------------------------------------------------------</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#first add empty rows for 2001:2011 &lt;- old method, now joining across all three datasets</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="cn">FALSE</span>){</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>bjs_prob_HI_filler <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2001</span><span class="sc">:</span><span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pop_begin =</span> <span class="fu">c</span>(<span class="dv">15707</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">22316</span>, <span class="dv">22211</span>, <span class="dv">21576</span>, <span class="dv">20931</span>, <span class="dv">20912</span>, <span class="dv">20516</span>, <span class="dv">19830</span>, <span class="dv">20196</span>, <span class="dv">19619</span>, <span class="dv">17291</span>, <span class="dv">17746</span>, <span class="dv">14341</span>),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pop_end =</span> <span class="fu">c</span>(<span class="dv">15525</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">22211</span>, <span class="dv">21576</span>, <span class="dv">20931</span>, <span class="dv">20912</span>, <span class="dv">20516</span>,  <span class="dv">19830</span>, <span class="dv">20196</span>, <span class="dv">19619</span>, <span class="dv">17291</span>, <span class="dv">17746</span>, <span class="dv">14341</span>, <span class="dv">14538</span>),</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">exits =</span> <span class="fu">c</span>(<span class="dv">6102</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">6297</span>, <span class="dv">5592</span>, <span class="dv">5303</span>, <span class="dv">5061</span>, <span class="dv">4796</span>,  <span class="dv">4557</span>, <span class="dv">4077</span>, <span class="dv">4225</span>, <span class="dv">3857</span>, <span class="dv">3981</span>, <span class="dv">5634</span>, <span class="dv">4028</span>))</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>bjs_prob_HI_stats_filler <span class="ot">&lt;-</span> bjs_prob_HI_filler <span class="sc">%&gt;%</span> </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exit_rate =</span> exits<span class="sc">/</span>((pop_begin <span class="sc">+</span> pop_end)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_mo =</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">1</span><span class="sc">/</span>exit_rate,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_yr =</span> <span class="dv">1</span><span class="sc">/</span>exit_rate,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"CE_BJS_survey"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>merged_CE_datasets <span class="ot">&lt;-</span> bjs_prob_HI_stats_filler <span class="sc">%&gt;%</span> </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(prob_HI_update_stats) <span class="sc">%&gt;%</span> </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(est_prob_term_length_yr, est_prob_term_length_mo, exit_rate), \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2012</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#plot BJS and new CE data</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_CE_datasets, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo, <span class="at">color =</span> source)) <span class="sc">+</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(year)), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Estimated Probation Term Length (months)"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"darkorange"</span>), <span class="co">#set colors manually</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"CE_BJS_survey"</span>, <span class="st">"CE_2024"</span>), <span class="co">#control the order of the labels</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Pew Method - high data entry lag"</span>, <span class="st">"Pew Method - low data entry lag"</span>) <span class="co">#customize labels</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_hline(yintercept = 22.4, color = "red", linetype = 2, size = 1) +</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">22.4</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"National Avg, 2018</span><span class="sc">\n</span><span class="st">22.4 months"</span>) <span class="sc">+</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 2017, y = 58.9, hjust = 0, vjust = -.5, label = "HI, 2018\n58.9 months") +</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2017</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">label =</span> <span class="st">"58.9 months"</span>) <span class="sc">+</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2000</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 1999, y = 30.7, hjust = 0, vjust = -.5, label = "HI, 2000\n30.7 months") +</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1999</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">label =</span> <span class="st">"30.7 months"</span>) <span class="sc">+</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hawaii Probation Term Lengths Across Time"</span>) <span class="sc">+</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-pew3" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="probation_term_length_report_2024-05-03_files/figure-html/fig-pew3-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;3: Probation length by year, high vs low data entry lag.</figcaption>
</figure>
</div>
</div>
</div>
<p>As can be seen by the <span style="color:darkorange;">orange line</span>, the estimated probation term length appears to drop by at least 12 months if not more for years 2012-2021 when enough time is provided for more complete data entry. Although less time has passed, there also appears to be a decrease by 4-5 months for 2022 and 2023. To due residual data entry lag, it is expected that estimtes for 2022 and especially 2023 will continue to drop (preliminary analysis shows that estimates for a given year stabilize after 2 years). This suggests that probation term lengths in Hawaii may be lower than originally reported, even for the peak year of 2018.</p>
</section>
</section>
<section id="issue-2-calculating-probation-length-indirectly" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="issue-2-calculating-probation-length-indirectly"><span class="header-section-number">4</span> Issue 2: Calculating probation length indirectly</h2>
<section id="problem-the-pew-report-estimates-probation-term-length-indirectly-but-the-validity-of-the-method-depends-on-assumptions-that-may-have-been-violated" class="level3" data-number="4.1">
<h3 data-number="4.1" class="anchored" data-anchor-id="problem-the-pew-report-estimates-probation-term-length-indirectly-but-the-validity-of-the-method-depends-on-assumptions-that-may-have-been-violated"><span class="header-section-number">4.1</span> Problem: The Pew report estimates probation term length indirectly but the validity of the method depends on assumptions that may have been violated</h3>
<p>Pew did not have access to individual case data, requiring them to use a method that allowed them to estimate probation term length indirectly using estimates of probation population size and number of exits. This method should deliver valid estimates so long as certain assumptions are met, including that the probation population is stable over time. But the population of probationers in Hawaii has changed more or less sharply, depending on the year.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>prob_HI_update <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"Stats01_run_in_2024_CY2012-CY2023_2024-04-29.xlsx"</span>, <span class="at">col_types =</span> <span class="st">"numeric"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>prob_HI_update <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2012</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">Year =</span> year, <span class="st">"Start population"</span> <span class="ot">=</span> pop_begin, <span class="st">"End population"</span> <span class="ot">=</span> pop_end, <span class="at">Exits =</span> exits) <span class="sc">%&gt;%</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="tbl-pop-size" class="anchored">
<table class="table table-sm table-striped small">
<caption>Table&nbsp;1: Changing beginning and ending probation population size over time</caption>
<thead>
<tr class="header">
<th style="text-align: right;">Year</th>
<th style="text-align: right;">Start population</th>
<th style="text-align: right;">End population</th>
<th style="text-align: right;">Exits</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2012</td>
<td style="text-align: right;">19943</td>
<td style="text-align: right;">19300</td>
<td style="text-align: right;">7929</td>
</tr>
<tr class="even">
<td style="text-align: right;">2013</td>
<td style="text-align: right;">19288</td>
<td style="text-align: right;">18040</td>
<td style="text-align: right;">7328</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2014</td>
<td style="text-align: right;">18010</td>
<td style="text-align: right;">18180</td>
<td style="text-align: right;">6367</td>
</tr>
<tr class="even">
<td style="text-align: right;">2015</td>
<td style="text-align: right;">18086</td>
<td style="text-align: right;">17770</td>
<td style="text-align: right;">6257</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2016</td>
<td style="text-align: right;">18060</td>
<td style="text-align: right;">17836</td>
<td style="text-align: right;">5936</td>
</tr>
<tr class="even">
<td style="text-align: right;">2017</td>
<td style="text-align: right;">17885</td>
<td style="text-align: right;">17151</td>
<td style="text-align: right;">5640</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2018</td>
<td style="text-align: right;">17181</td>
<td style="text-align: right;">16917</td>
<td style="text-align: right;">5462</td>
</tr>
<tr class="even">
<td style="text-align: right;">2019</td>
<td style="text-align: right;">16968</td>
<td style="text-align: right;">16422</td>
<td style="text-align: right;">5887</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2020</td>
<td style="text-align: right;">16485</td>
<td style="text-align: right;">14979</td>
<td style="text-align: right;">4916</td>
</tr>
<tr class="even">
<td style="text-align: right;">2021</td>
<td style="text-align: right;">15035</td>
<td style="text-align: right;">15931</td>
<td style="text-align: right;">4837</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: right;">15946</td>
<td style="text-align: right;">13849</td>
<td style="text-align: right;">5889</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: right;">13917</td>
<td style="text-align: right;">14012</td>
<td style="text-align: right;">4320</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This could introduce inaccuracy when using the indirect method. How does probation term length change, if at all, when using a direct approach that relies on calculating probation term length at the individual case level and averaging across cases?</p>
</section>
<section id="solution-using-a-direct-method-to-estimate-probation-term-length" class="level3" data-number="4.2">
<h3 data-number="4.2" class="anchored" data-anchor-id="solution-using-a-direct-method-to-estimate-probation-term-length"><span class="header-section-number">4.2</span> Solution: Using a direct method to estimate probation term length</h3>
<p>For each probationer, a probation term length was calculated by taking the difference between the start and termination of their probation term. <em>This calculation is not based on how long they were ordered to serve by a judge but by how long they actually served.</em> Each supervision case was assigned to a calendar year based on the year of the case termination. All of the individual term lengths that were grouped in a given year where then averaged to get an estimate of probation term length.</p>
<p><span class="math display">\[probationer.term.length = probation.end.date - probation.start.date\]</span> <span class="math display">\[ estimated.probation.term.length_{year} = \frac{1}{n} \sum_{i = 1}^n({probation.end.date_{i,year} - probation.start.date_{i,year}})\]</span> Where <em>i</em> is an individual probationer, <em>n</em> is the total number of probationers in a cohort, and <em>year</em> is a calendar year.</p>
<p>Individual case data was pulled from CX, the database underlying Caseload Explorer.</p>
<div class="cell">
<details>
<summary>Show the SQL code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">--SQL code</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>O.Pin,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">convert</span>(<span class="dt">date</span>,O.DOB) <span class="kw">AS</span> DOB,</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>O.Gender,</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>O.LastName,</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>O.FirstName,</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetPersonAttributeValue(O.PersonId, <span class="kw">NULL</span>, <span class="st">'Person_SID'</span>) <span class="kw">AS</span> SID,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'Sup lvl'</span>) <span class="kw">AS</span> SupervisionLevel, <span class="co">--current/active/most recent supervision level</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>A3.firstSupLevel <span class="kw">AS</span> InitialSupervisionLevel, <span class="co">--initial supervision level</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>C.Name <span class="kw">AS</span> <span class="st">'Caseload Name'</span>,</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'CASE_SpecialGroups'</span>) <span class="kw">AS</span> SpecialGroups,</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>(<span class="kw">LEFT</span>(CX.dbo.GetCaseAttributeValue(CA.ParentCaseId, <span class="kw">NULL</span>, <span class="st">'CourtCircuit'</span>), <span class="dv">1</span>) <span class="op">+</span> <span class="st">'/'</span> <span class="op">+</span> <span class="kw">LEFT</span>(CX.dbo.GetCaseAttributeValue(CA.ParentCaseId, <span class="kw">NULL</span>, <span class="st">'Court'</span>), <span class="dv">1</span>)) <span class="kw">AS</span> CircuitCourt,</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>CA.ChildCaseId,</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>CA.ParentCaseId,</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>CC.CaseNumber <span class="kw">AS</span> docCaseNumber, <span class="co">--Parent/Docket Case #</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="kw">Child</span>.CaseNumber <span class="kw">AS</span> supCaseNumber, <span class="co">--Child/Supervision Case #</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>CT.Name <span class="kw">as</span> <span class="st">'Case Type'</span>,</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'Termination'</span>) <span class="kw">AS</span> Termination,</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'TerminationDate'</span>) <span class="kw">AS</span> TerminationDate,</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="fu">convert</span>(<span class="dt">date</span>,<span class="kw">Child</span>.StartDate) <span class="kw">as</span> <span class="st">'Supervision Start Date'</span>, <span class="co">--current/active/most recent supervision level</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>A1.minStartDate <span class="kw">AS</span> HistoricalSupervisionStartDate, <span class="co">--historical supervision start date</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="fu">convert</span>(<span class="dt">date</span>,CC.CloseDateTime) <span class="kw">AS</span> CloseDateTime,</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>X.TypeName <span class="kw">as</span> <span class="st">'Charge Type'</span>,</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>X.StatuteDescription,</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>X.OffenseLevel,</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>X.OffenseCode,</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>X.OffenseDegree,</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>X.OffenseDescription,</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>CG.ChargeId,</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetChargeAttributeValue(CG.ChargeId, <span class="kw">NULL</span>, <span class="st">'Dispo'</span>) <span class="kw">As</span> Disposition,</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetChargeAttributeValue(CG.ChargeId, <span class="kw">NULL</span>, <span class="st">'DispositionDate'</span>) <span class="kw">As</span> DispositionDate</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>CX.dbo.OffenderInfo O</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CourtCase CC <span class="kw">on</span> o.<span class="kw">Id</span> <span class="op">=</span> CC.OffenderId</span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CaseCase CA <span class="kw">on</span> Ca.ParentCaseId <span class="op">=</span> CC.<span class="kw">Id</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CourtCase <span class="kw">Child</span> <span class="kw">on</span> <span class="kw">Child</span>.<span class="kw">Id</span> <span class="op">=</span> CA.ChildCaseId</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CaseType CT <span class="kw">on</span> CT.<span class="kw">Id</span> <span class="op">=</span> <span class="kw">Child</span>.CaseTypeId</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.Caseload C <span class="kw">ON</span> C.<span class="kw">Id</span> <span class="op">=</span> O.CaseloadId</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> (<span class="kw">SELECT</span> CaseId, <span class="fu">MIN</span>(<span class="fu">Value</span>) <span class="kw">AS</span> minStartDate <span class="kw">FROM</span> CX.dbo.CaseAttribute <span class="kw">WHERE</span> AttributeId <span class="op">=</span> <span class="dv">3956</span> <span class="kw">GROUP</span> <span class="kw">BY</span> CaseId) A1 <span class="kw">ON</span> A1.CaseId <span class="op">=</span> CA.ChildCaseId <span class="co">--AttributeId = 3956 -&gt; attributeId for start date</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> (<span class="kw">SELECT</span> CaseId, <span class="fu">MIN</span>(FromTime) <span class="kw">AS</span> minFromTime <span class="kw">FROM</span> CX.dbo.CaseAttribute <span class="kw">WHERE</span> AttributeId <span class="op">=</span> <span class="dv">87</span> <span class="kw">GROUP</span> <span class="kw">BY</span> CaseId) A2 <span class="kw">ON</span> A2.CaseId <span class="op">=</span> CA.ChildCaseId <span class="co">--AttributeId = 87 -&gt; attributeId for supervision level</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> (<span class="kw">SELECT</span> CaseId, FromTime, <span class="fu">Value</span> <span class="kw">AS</span> firstSupLevel <span class="kw">FROM</span> CX.dbo.CaseAttribute <span class="kw">WHERE</span> AttributeId <span class="op">=</span> <span class="dv">87</span>) A3 <span class="kw">ON</span> A3.CaseId <span class="op">=</span> CA.ChildCaseId <span class="kw">AND</span> A3.FromTime <span class="op">=</span> A2.minFromTime</span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CaseCharge CG <span class="kw">ON</span> Ca.ParentCaseId <span class="op">=</span> CG.CaseId <span class="co">--on CC.Id/Parent CaseId b/c charges stored at docket level</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="kw">Outer</span> Apply (<span class="kw">Select</span> S.OffenseLevel, OffenseCode, OffenseDegree, OffenseDescription, CCh.TypeName, CCH.StatuteDescription <span class="kw">from</span> CX.dbo.Statute s <span class="kw">join</span> CX.dbo.charge ch <span class="kw">on</span> s.<span class="kw">Id</span> <span class="op">=</span> ch.statuteid <span class="kw">join</span> CX.Hawaii.CaseChargeInfo cch <span class="kw">on</span> cch.<span class="kw">Id</span> <span class="op">=</span> ch.<span class="kw">id</span> <span class="kw">where</span> cch.caseid <span class="op">=</span> cc.<span class="kw">id</span> <span class="kw">AND</span> CG.ChargeId <span class="op">=</span> ch.<span class="kw">id</span>) X</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="co">--convert TerminationDate to date type in order to filter by date; h/t: https://stackoverflow.com/questions/14397569/filter-data-based-on-date-in-sql; h/t: https://stackoverflow.com/questions/1334143/datetime2-vs-datetime-in-sql-server</span></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a>(<span class="fu">CONVERT</span>(<span class="dt">date</span>,CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'TerminationDate'</span>)) <span class="kw">BETWEEN</span> <span class="st">'1/1/2000'</span> <span class="kw">AND</span> <span class="st">'12/31/2023'</span>)  <span class="co">--filter by supervision termination date</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="kw">AND</span> CT.<span class="kw">Id</span> <span class="op">=</span> <span class="dv">39</span> <span class="co">--supervision code</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> LastName</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here are the direct estimates of probation term length plotted against the indirect method using the old and the new Caseload Explorer data.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages -----------------------------------------------------------</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># import data -------------------------------------------------------------</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>prob_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"probation_term_length_extract_CY00-CY23_2024-04-29.csv"</span>)</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Direct Method: case-level data compute data --------------------------------------------------------------</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>prob_data_clean <span class="ot">&lt;-</span> prob_data <span class="sc">%&gt;%</span> </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_start =</span> <span class="fu">strptime</span>(HistoricalSupervisionStartDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_term =</span> <span class="fu">strptime</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_days =</span> <span class="fu">difftime</span>(prob_term, prob_start, <span class="at">units =</span> <span class="st">"days"</span>),</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_yrs =</span> <span class="fu">as.double</span>(prob_length_days)<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">cyear =</span> <span class="fu">as.factor</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),<span class="st">"%Y"</span>))</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a><span class="co"># QA1 do start and end dates vary within a supervision case? --------------</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Yes -&gt; about 30 cases, at least two instances where case was opened in error/duplicate</span></span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>QA1 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA1){</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>  term_length_variation <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> </span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">term_variation =</span> <span class="fu">sd</span>(prob_length_days)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: Remarks - Duplicate case in CE.</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  test1 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP-06-1-0998-1'</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: Remarks - Duplicate Entry</span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>  test2 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP 2FFC-17-0000072'</span>)</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: note clear...</span></span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  test3 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP-03-0414-1'</span>)</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="co"># QA2: duplicate rows -----------------------------------------------------</span></span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a><span class="co">#multiple charges</span></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>QA2 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA2){</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>  test1 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(LastName <span class="sc">==</span> <span class="st">"Ababa"</span>)</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  test1 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="dv">426999</span>)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a><span class="co"># clean data --------------------------------------------------------------</span></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a><span class="co">#step 1: remove duplicates -&gt; often due to multiple charges, sometimes multiple dispo dates, multiplying rows</span></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>prob_data_clean2 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="co">#%&gt;% </span></span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrange(desc(prob_length_yrs))</span></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a><span class="co">#QA2.1: check the test cases from above with variation in term length, check that it's pulling the longest term -&gt; conservative----</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>QA2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA2<span class="fl">.1</span>){</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>  test1b <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP-06-1-0998-1'</span>)</span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: Remarks - Duplicate Entry</span></span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>  test2b <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP 2FFC-17-0000072'</span>)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: note clear...</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>  test3b <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP-03-0414-1'</span>)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a><span class="co"># QA3: negative term lengths ----------------------------------------------</span></span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>QA3 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA3){</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>  neg_term_lengths <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(prob_length_days <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>  prob_data_clean3 <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(prob_length_days <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>  <span class="co">#boxplot</span></span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(prob_data_clean3, <span class="fu">aes</span>(<span class="at">x =</span> cyear, <span class="at">y =</span> prob_length_yrs, <span class="at">fill =</span> cyear)) <span class="sc">+</span></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scale_fill_brewer(type = "qual", palette = 1) +</span></span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># geom_jitter(color="gray27", size=0.3, alpha=0.3) +</span></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NULL</span></span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a><span class="co">#violin</span></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prob_data_clean3, <span class="fu">aes</span>(<span class="at">x =</span> cyear, <span class="at">y =</span> prob_length_yrs, <span class="at">fill =</span> cyear)) <span class="sc">+</span></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_brewer(type = "qual", palette = 1) +</span></span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_jitter(color="black", size=0.3, alpha=0.1) +</span></span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a><span class="co">#histo</span></span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prob_data_clean3, <span class="fu">aes</span>(<span class="at">x =</span> prob_length_yrs, <span class="at">fill =</span> cyear)) <span class="sc">+</span></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_brewer(type = "qual", palette = 1) +</span></span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cyear)</span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a><span class="co"># descriptive stats -------------------------------------------------------</span></span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a><span class="co">#count persons, include negative length terms &lt;- need to be fixed by probation staff</span></span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>prob_data_stats <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(prob_length_yrs &lt; 20) %&gt;% #exploratory analysis filtering out outliars</span></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyear) <span class="sc">%&gt;%</span> </span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_of_probationers =</span> <span class="fu">n</span>(),</span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_yr =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T), </span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_yr =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_yr =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_mo =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>, </span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_mo =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>,</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_mo =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>  </span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(mean_yr<span class="sc">:</span>sd_mo, \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>)),</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_probation_term_length =</span> <span class="fu">paste0</span>(mean_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, mean_mo, <span class="st">" months)"</span>),</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>         <span class="at">median_probation_term_length =</span> <span class="fu">paste0</span>(median_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, median_mo, <span class="st">" months)"</span>),</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_probation_term_length =</span> <span class="fu">paste0</span>(sd_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, sd_mo, <span class="st">" months)"</span>)</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">calendar_year =</span> cyear, number_of_probationers, mean_mo, mean_yr, mean_probation_term_length<span class="sc">:</span>sd_probation_term_length)</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(prob_data_stats, paste0("probation_term_length_CY14-CY23_results_", Sys.Date(), ".csv"), row.names = F)</span></span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a><span class="co"># QA4: Comparing old vs new data pulls ------------------------------------</span></span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>QA4 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA4){</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>prob_data_2024_02_06 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"probation_term_length_extract_CY00-CY23_2024-02-06.csv"</span>)</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>prob_data_clean_2024_02_06 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> </span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_start =</span> <span class="fu">strptime</span>(HistoricalSupervisionStartDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_term =</span> <span class="fu">strptime</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_days =</span> <span class="fu">difftime</span>(prob_term, prob_start, <span class="at">units =</span> <span class="st">"days"</span>),</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_yrs =</span> <span class="fu">as.double</span>(prob_length_days)<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>         <span class="at">cyear =</span> <span class="fu">as.factor</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),<span class="st">"%Y"</span>))</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a><span class="co"># prob_data_clean2_2024_02_06 &lt;- prob_data_clean_2024_02_06 %&gt;% </span></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;% </span></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() </span></span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a>prob_data_2024_03_19 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"probation_term_length_extract_CY00-CY23_2024-03-19.csv"</span>)</span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>prob_data_clean_2024_03_19 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> </span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_start =</span> <span class="fu">strptime</span>(HistoricalSupervisionStartDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_term =</span> <span class="fu">strptime</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_days =</span> <span class="fu">difftime</span>(prob_term, prob_start, <span class="at">units =</span> <span class="st">"days"</span>),</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_yrs =</span> <span class="fu">as.double</span>(prob_length_days)<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>         <span class="at">cyear =</span> <span class="fu">as.factor</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),<span class="st">"%Y"</span>))</span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a><span class="co"># prob_data_clean2_2024_03_19 &lt;- prob_data_clean_2024_03_19 %&gt;% </span></span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;% </span></span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()  </span></span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>prob_data_2024_04_03 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"probation_term_length_extract_CY00-CY23_2024-04-03.csv"</span>)</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>prob_data_clean_2024_04_03 <span class="ot">&lt;-</span> prob_data_2024_04_03 <span class="sc">%&gt;%</span> </span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_start =</span> <span class="fu">strptime</span>(HistoricalSupervisionStartDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_term =</span> <span class="fu">strptime</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_days =</span> <span class="fu">difftime</span>(prob_term, prob_start, <span class="at">units =</span> <span class="st">"days"</span>),</span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_yrs =</span> <span class="fu">as.double</span>(prob_length_days)<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>         <span class="at">cyear =</span> <span class="fu">as.factor</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),<span class="st">"%Y"</span>))</span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a><span class="co"># prob_data_clean2_2024_04_03 &lt;- prob_data_clean_2024_04_03 %&gt;% </span></span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;% </span></span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() </span></span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>anti_join_02_to_03 <span class="ot">&lt;-</span> prob_data_clean_2024_02_06 <span class="sc">%&gt;%</span> </span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Caseload.Name, <span class="sc">-</span>SpecialGroups) <span class="sc">%&gt;%</span> <span class="co">#caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(prob_data_clean_2024_03_19) <span class="sc">%&gt;%</span> </span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>anti_join_03_to_02 <span class="ot">&lt;-</span> prob_data_clean_2024_03_19 <span class="sc">%&gt;%</span></span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Caseload.Name, <span class="sc">-</span>SpecialGroups) <span class="sc">%&gt;%</span> <span class="co">#caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(prob_data_clean_2024_02_06) <span class="sc">%&gt;%</span></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a><span class="co"># anti_join_03_to_04 &lt;- prob_data_clean_2024_03_19 %&gt;% </span></span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-Caseload.Name, -SpecialGroups) %&gt;% #caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a><span class="co">#   anti_join(prob_data_clean_2024_04_03) %&gt;% </span></span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;%</span></span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a><span class="co"># anti_join_04_to_03 &lt;- prob_data_clean_2024_04_03 %&gt;% </span></span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-Caseload.Name, -SpecialGroups) %&gt;% #caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a><span class="co">#   anti_join(prob_data_clean_2024_03_19) %&gt;% </span></span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;%</span></span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>anti_join_02_to_04 <span class="ot">&lt;-</span> prob_data_clean_2024_02_06 <span class="sc">%&gt;%</span> </span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Caseload.Name, <span class="sc">-</span>SpecialGroups) <span class="sc">%&gt;%</span> <span class="co">#caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(prob_data_clean_2024_04_03, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Pin"</span>, <span class="st">"ChildCaseId"</span>, <span class="st">"prob_start"</span>, <span class="st">"prob_term"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a>anti_join_04_to_02 <span class="ot">&lt;-</span> prob_data_clean_2024_04_03 <span class="sc">%&gt;%</span></span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Caseload.Name, <span class="sc">-</span>SpecialGroups) <span class="sc">%&gt;%</span> <span class="co">#caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a>  <span class="co"># anti_join(prob_data_clean_2024_02_06) %&gt;%</span></span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(prob_data_clean_2024_02_06, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Pin"</span>, <span class="st">"ChildCaseId"</span>, <span class="st">"prob_start"</span>, <span class="st">"prob_term"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a>anti_join_04_to_02 <span class="sc">%&gt;%</span> </span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cyear)</span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a><span class="co">#example 1: case term in 9/23 but entered in CE on 02/24</span></span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"518058"</span>)</span>
<span id="cb5-232"><a href="#cb5-232" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"518058"</span>)</span>
<span id="cb5-233"><a href="#cb5-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-234"><a href="#cb5-234" aria-hidden="true" tabindex="-1"></a><span class="co">#example 2 -&gt; couldn't figure out...hold up:</span></span>
<span id="cb5-235"><a href="#cb5-235" aria-hidden="true" tabindex="-1"></a><span class="co"># Id    OffenderId  EnteredByPId    FromTime    CaseNumber  CloseDateTime   CaseTypeId  BookingId   StartDate   EndDate JurisdictionLId DispositionId   Sealed  LastModified    REC_ID</span></span>
<span id="cb5-236"><a href="#cb5-236" aria-hidden="true" tabindex="-1"></a><span class="co"># 697576    176995  111855  2023-06-07 15:27:54.143 SP 5DTC-23-000801-1 2023-12-08 11:08:00.000 39  NULL    2023-06-06 00:00:00.000 2023-12-05 00:00:00.000 NULL    NULL    0   2024-02-09 12:36:41.943 NULL</span></span>
<span id="cb5-237"><a href="#cb5-237" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"579792"</span>)</span>
<span id="cb5-238"><a href="#cb5-238" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"579792"</span>)</span>
<span id="cb5-239"><a href="#cb5-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-240"><a href="#cb5-240" aria-hidden="true" tabindex="-1"></a><span class="co">#example 3: case term in 6/21 but entered in CE on 03/24</span></span>
<span id="cb5-241"><a href="#cb5-241" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"579792"</span>)</span>
<span id="cb5-242"><a href="#cb5-242" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"579792"</span>)</span>
<span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a><span class="co">#example 4: case term in 11/23 but entered in CE on 03/24</span></span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"569710"</span>)</span>
<span id="cb5-246"><a href="#cb5-246" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"569710"</span>)</span>
<span id="cb5-247"><a href="#cb5-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-248"><a href="#cb5-248" aria-hidden="true" tabindex="-1"></a><span class="co">#example 5: case term in 04/23 but entered in CE on 03/24</span></span>
<span id="cb5-249"><a href="#cb5-249" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"512076"</span>)</span>
<span id="cb5-250"><a href="#cb5-250" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"512076"</span>)</span>
<span id="cb5-251"><a href="#cb5-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-252"><a href="#cb5-252" aria-hidden="true" tabindex="-1"></a><span class="co">#example 6: formatting of docCaseNumber got converted into a date for 2024/02/06, import issue?</span></span>
<span id="cb5-253"><a href="#cb5-253" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"513305"</span>)</span>
<span id="cb5-254"><a href="#cb5-254" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"513305"</span>)</span>
<span id="cb5-255"><a href="#cb5-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-256"><a href="#cb5-256" aria-hidden="true" tabindex="-1"></a><span class="co">#example 7: there was a change in Special Group, was showing up in 2 but not 3, fixed select to exclude SpecialGroups</span></span>
<span id="cb5-257"><a href="#cb5-257" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"2992"</span>)</span>
<span id="cb5-258"><a href="#cb5-258" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"2992"</span>)</span>
<span id="cb5-259"><a href="#cb5-259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-260"><a href="#cb5-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-261"><a href="#cb5-261" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-262"><a href="#cb5-262" aria-hidden="true" tabindex="-1"></a><span class="co"># merge three datasets ---------------------------------------------------------------</span></span>
<span id="cb5-263"><a href="#cb5-263" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-264"><a href="#cb5-264" aria-hidden="true" tabindex="-1"></a>merge_method <span class="ot">&lt;-</span> <span class="st">"bind_row_method"</span></span>
<span id="cb5-265"><a href="#cb5-265" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(merge_method <span class="sc">==</span> <span class="st">"join_method"</span>){</span>
<span id="cb5-266"><a href="#cb5-266" aria-hidden="true" tabindex="-1"></a>  <span class="co">#step 1a - join BJS (CE) data, new CE data, and new CX data</span></span>
<span id="cb5-267"><a href="#cb5-267" aria-hidden="true" tabindex="-1"></a>  merged_datasets <span class="ot">&lt;-</span> bjs_prob_HI_stats_filler <span class="sc">%&gt;%</span> </span>
<span id="cb5-268"><a href="#cb5-268" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(prob_HI_update_stats, <span class="at">by =</span> <span class="st">"year"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_bjs_CE"</span>, <span class="st">"_ac_CE"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-269"><a href="#cb5-269" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-270"><a href="#cb5-270" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(prob_data_stats, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span><span class="ot">=</span><span class="st">"calendar_year"</span>))</span>
<span id="cb5-271"><a href="#cb5-271" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(merge_method <span class="sc">==</span> <span class="st">"bind_row_method"</span>){</span>
<span id="cb5-272"><a href="#cb5-272" aria-hidden="true" tabindex="-1"></a>  <span class="co">#step 1b - row bind BJS (CE) data, new CE data, and new CX data</span></span>
<span id="cb5-273"><a href="#cb5-273" aria-hidden="true" tabindex="-1"></a>  merged_datasets <span class="ot">&lt;-</span> prob_data_stats <span class="sc">%&gt;%</span> </span>
<span id="cb5-274"><a href="#cb5-274" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">year =</span> calendar_year, <span class="at">exits =</span> number_of_probationers, <span class="at">est_prob_term_length_yr =</span> mean_yr, <span class="at">est_prob_term_length_mo =</span> mean_mo) <span class="sc">%&gt;%</span> </span>
<span id="cb5-275"><a href="#cb5-275" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">levels</span>(year))[year],</span>
<span id="cb5-276"><a href="#cb5-276" aria-hidden="true" tabindex="-1"></a>           <span class="at">source =</span> <span class="st">"CX_2024"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-277"><a href="#cb5-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(bjs_prob_HI_stats_filler, prob_HI_update_stats) <span class="sc">%&gt;%</span> </span>
<span id="cb5-278"><a href="#cb5-278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(est_prob_term_length_yr, est_prob_term_length_mo, exit_rate), \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb5-279"><a href="#cb5-279" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2012</span>)</span>
<span id="cb5-280"><a href="#cb5-280" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-281"><a href="#cb5-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-282"><a href="#cb5-282" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-283"><a href="#cb5-283" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data ---------------------------------------------------------------</span></span>
<span id="cb5-284"><a href="#cb5-284" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-285"><a href="#cb5-285" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_datasets, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo, <span class="at">color =</span> source)) <span class="sc">+</span></span>
<span id="cb5-286"><a href="#cb5-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb5-287"><a href="#cb5-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb5-288"><a href="#cb5-288" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line(data = prob_HI_update_stats, aes(x = year, y = est_prob_term_length_mo), </span></span>
<span id="cb5-289"><a href="#cb5-289" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           color = "orange",</span></span>
<span id="cb5-290"><a href="#cb5-290" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           alpha = if_else(prob_HI_update_stats$year &gt;= 2021, 0.3, 1)) +</span></span>
<span id="cb5-291"><a href="#cb5-291" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(data = prob_HI_update_stats, #data = prob_HI_update_stats %&gt;% filter(year &gt;= 2012), </span></span>
<span id="cb5-292"><a href="#cb5-292" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            # aes(x = year, y = est_prob_term_length_mo, alpha = -year, size = year), </span></span>
<span id="cb5-293"><a href="#cb5-293" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            aes(x = year, y = est_prob_term_length_mo), </span></span>
<span id="cb5-294"><a href="#cb5-294" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            color = "orange",</span></span>
<span id="cb5-295"><a href="#cb5-295" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            alpha = if_else(prob_HI_update_stats$year &gt;= 2022, 0.3, 1)) + #alpha = ((prob_HI_update_stats$year-2012)/(2023-2012))*(1-0.5)+0.5</span></span>
<span id="cb5-296"><a href="#cb5-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(year)), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb5-297"><a href="#cb5-297" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(aes(label = paste0(janitor::round_half_up(est_prob_term_length_mo, digits = 1))), vjust = 0, nudge_y = 1, color = "gray") +</span></span>
<span id="cb5-298"><a href="#cb5-298" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_continuous(NULL, limits = c(2012, 2021)) +</span></span>
<span id="cb5-299"><a href="#cb5-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Estimated Probation Term Length (months)"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb5-300"><a href="#cb5-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"darkorange"</span>, <span class="st">"gold"</span>), <span class="co">#set colors manually</span></span>
<span id="cb5-301"><a href="#cb5-301" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"CE_BJS_survey"</span>, <span class="st">"CE_2024"</span>, <span class="st">"CX_2024"</span>), <span class="co">#control the order of the labels</span></span>
<span id="cb5-302"><a href="#cb5-302" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Pew Method - high data entry lag"</span>, <span class="st">"Pew Method - low data entry lag*"</span>, <span class="st">"Direct method - low data entry lag"</span>) <span class="co">#customize labels</span></span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true" tabindex="-1"></a>                     ) <span class="sc">+</span></span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_hline(yintercept = 22.4, color = "red", linetype = 2, size = 1) +</span></span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">22.4</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"National Avg, 2018</span><span class="sc">\n</span><span class="st">22.4 months"</span>) <span class="sc">+</span></span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 2017, y = 58.9, hjust = 0, vjust = -.5, label = "HI, 2018\n58.9 months") +</span></span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2017</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">label =</span> <span class="st">"58.9 months"</span>) <span class="sc">+</span></span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2000</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 1999, y = 30.7, hjust = 0, vjust = -.5, label = "HI, 2000\n30.7 months") +</span></span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1999</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">label =</span> <span class="st">"30.7 months"</span>) <span class="sc">+</span></span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hawaii Probation Term Lengths Across Time"</span>) <span class="sc">+</span></span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-pew4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="probation_term_length_report_2024-05-03_files/figure-html/fig-pew4-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;4: Probation length by year, comparing the direct method to the Pew (indirect) method</figcaption>
</figure>
</div>
</div>
</div>
<p>The <span style="color:gold;">direct method</span> with new data and <span style="color:darkorange;">indirect method</span> with new data yield similar, though not identical, results, both suggesting estimated probation term lengths are lower compared to those estimates using an indirect method with data suffering from data entry lag.</p>
</section>
</section>
<section id="issue-3-aggregating-felony-and-non-felony-probationers" class="level2 page-columns page-full" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="issue-3-aggregating-felony-and-non-felony-probationers"><span class="header-section-number">5</span> Issue 3: Aggregating felony and non-felony probationers</h2>
<section id="problem-the-pew-report-aggregates-felony-and-non-felony-probationers-but-the-mean-of-data-containing-two-mostly-non-overlapping-groups-is-often-meaningless" class="level3" data-number="5.1">
<h3 data-number="5.1" class="anchored" data-anchor-id="problem-the-pew-report-aggregates-felony-and-non-felony-probationers-but-the-mean-of-data-containing-two-mostly-non-overlapping-groups-is-often-meaningless"><span class="header-section-number">5.1</span> Problem: The Pew report aggregates felony and non-felony probationers but the mean of data containing two (mostly) non-overlapping groups is often meaningless</h3>
<p>Consider a room filled with 100 government workers and 100 tech industry multi-millionaires. The average salary in the room ends up not representing anyone. When a data distribution is bimodal, the mean is often meaningless.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-histo-example" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="probation_term_length_report_2024-05-03_files/figure-html/fig-histo-example-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;5: Salary distribution for government works and tech multi-millionaires (data is hypothetical)</figcaption>
</figure>
</div>
</div>
</div>
<p>The probation term lengths for felony and misdemeanor probationers are like salaries in this example. Felony and misdemeanor probationers are in effect two different sub-populations with distinct distributions for term length, and conceptually, mixing them and taking an average can produce a distorted representation of probation term length. When there are two sub-groups in a dataset, it is often conceptually clearer to disaggregate the data by group and compute separate means for each.</p>
</section>
<section id="solution-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data" class="level3 page-columns page-full" data-number="5.2">
<h3 data-number="5.2" class="anchored" data-anchor-id="solution-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data"><span class="header-section-number">5.2</span> Solution: Disaggregating felony and non-felony using a direct method and stable data</h3>
<p>First, here is the distribution of probation term lengths, disaggregated by offense degree and year. Note the empirical support for mostly non-overlapping distributions across years.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#count persons, include negative length terms &lt;- need to be fixed by probation staff</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>prob_data_degree_factors_stats <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(prob_length_yrs &lt; 20) %&gt;% #exploratory analysis filtering out outliars</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OffenseDegree_categories =</span> <span class="fu">case_when</span>(OffenseDegree <span class="sc">==</span> <span class="st">"FA"</span> <span class="sc">~</span> <span class="st">"FA"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                                              OffenseDegree <span class="sc">==</span> <span class="st">"FB"</span> <span class="sc">~</span> <span class="st">"FB"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>                                              OffenseDegree <span class="sc">==</span> <span class="st">"FC"</span> <span class="sc">~</span> <span class="st">"FC"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>                                              OffenseDegree <span class="sc">==</span> <span class="st">"MD"</span> <span class="sc">~</span> <span class="st">"MD"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>                                              OffenseDegree <span class="sc">==</span> <span class="st">"PM"</span> <span class="sc">~</span> <span class="st">"PM"</span>,</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                                              <span class="co"># OffenseDegree %in% c("V", "VL", "") ~ "Other"</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">.default =</span> <span class="st">"other"</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                                              <span class="co"># TRUE ~ "other"</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                                              ),</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">OffenseDegree_categories =</span> <span class="fu">factor</span>(OffenseDegree_categories, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"FA"</span>,<span class="st">"FB"</span>,<span class="st">"FC"</span>,<span class="st">"MD"</span>,<span class="st">"PM"</span>,<span class="st">"other"</span>)),</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">offense_F_MD =</span> <span class="fu">case_when</span>(OffenseDegree <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FA"</span>, <span class="st">"FB"</span>, <span class="st">"FC"</span>) <span class="sc">~</span> <span class="st">"Felony"</span>,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                                  OffenseDegree <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MD"</span>, <span class="st">"PM"</span>) <span class="sc">~</span> <span class="st">"MD-PM"</span>,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">.default =</span> <span class="st">"other"</span></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>                                  ),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">offense_F_MD =</span> <span class="fu">factor</span>(offense_F_MD, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Felony"</span>, <span class="st">"MD-PM"</span>, <span class="st">"other"</span>))</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="co">#histo of both coarse and fine</span></span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="co">#filter negative prob term lengths and term lengths &gt; 21 years to keep plots from running to far out along x-axis on histo</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prob_data_degree_factors_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="dv">0</span> <span class="sc">&lt;=</span> prob_length_yrs, prob_length_yrs <span class="sc">&lt;</span> <span class="dv">20</span>, <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(cyear)) <span class="sc">&gt;=</span> <span class="dv">2012</span>), </span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> prob_length_yrs, <span class="at">fill =</span> offense_F_MD)) <span class="sc">+</span></span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">1</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">position =</span> <span class="st">"identity"</span>,<span class="at">color=</span><span class="st">"#e9ecef"</span>) <span class="sc">+</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">name =</span> <span class="st">"Probation term length (years)"</span>) <span class="sc">+</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">"Offense degree"</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">"#404080"</span>, <span class="st">"goldenrod"</span>, <span class="st">"#69b3a2"</span>)) <span class="sc">+</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cyear) <span class="sc">+</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-histo" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="probation_term_length_report_2024-05-03_files/figure-html/fig-histo-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption class="figure-caption">Figure&nbsp;6: Distribution of probation term length disaggregated by offense severity</figcaption>
</figure>
</div>
</div>
</div>
<p>Next, here is probation term length as a function of year. The graph on the left breaks down offense severity into FA, FB, FC, MD, PM, and other. The plot on the right lumps all felonies together and all MD and PM together.</p>
<div class="page-columns page-full">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Disaggregate Direct method with new CX data by F vs MD/PM----</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#fine df: "FA","FB","FC","MD","PM","other"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>prob_data_degree_fine_stats <span class="ot">&lt;-</span> prob_data_degree_factors_stats <span class="sc">%&gt;%</span> </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyear, OffenseDegree_categories) <span class="sc">%&gt;%</span> </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_of_probationers =</span> <span class="fu">n</span>(),</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_yr =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T), </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_yr =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_yr =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_mo =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_mo =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_mo =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>  </span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(mean_yr<span class="sc">:</span>sd_mo, \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>)),</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_probation_term_length =</span> <span class="fu">paste0</span>(mean_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, mean_mo, <span class="st">" months)"</span>),</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">median_probation_term_length =</span> <span class="fu">paste0</span>(median_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, median_mo, <span class="st">" months)"</span>),</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_probation_term_length =</span> <span class="fu">paste0</span>(sd_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, sd_mo, <span class="st">" months)"</span>)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">year =</span> cyear, OffenseDegree_categories, <span class="at">exits =</span> number_of_probationers, <span class="at">est_prob_term_length_yr =</span> mean_yr, <span class="at">est_prob_term_length_mo =</span> mean_mo) <span class="sc">%&gt;%</span> </span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">levels</span>(year))[year])<span class="sc">%&gt;%</span> </span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2012</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">#coarse df: "Felony", "MD-PM", "other"</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>prob_data_degree_coarse_stats <span class="ot">&lt;-</span> prob_data_degree_factors_stats <span class="sc">%&gt;%</span> </span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyear, offense_F_MD) <span class="sc">%&gt;%</span> </span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_of_probationers =</span> <span class="fu">n</span>(),</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_yr =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T), </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_yr =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_yr =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_mo =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>, </span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_mo =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>,</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_mo =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>  </span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(mean_yr<span class="sc">:</span>sd_mo, \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>)),</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_probation_term_length =</span> <span class="fu">paste0</span>(mean_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, mean_mo, <span class="st">" months)"</span>),</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">median_probation_term_length =</span> <span class="fu">paste0</span>(median_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, median_mo, <span class="st">" months)"</span>),</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_probation_term_length =</span> <span class="fu">paste0</span>(sd_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, sd_mo, <span class="st">" months)"</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">year =</span> cyear, offense_F_MD, <span class="at">exits =</span> number_of_probationers, <span class="at">est_prob_term_length_yr =</span> mean_yr, <span class="at">est_prob_term_length_mo =</span> mean_mo) <span class="sc">%&gt;%</span> </span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">levels</span>(year))[year])<span class="sc">%&gt;%</span> </span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2012</span>)</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a><span class="co">#PLOT 1: put coarse and fine grained on same plot</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(prob_data_degree_fine_stats, aes(x = year, y = est_prob_term_length_mo, color = OffenseDegree_categories)) +</span></span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = prob_data_degree_coarse_stats %&gt;% filter(offense_F_MD == "Felony"), aes(x = year, y = est_prob_term_length_mo, size = exits), color = "black") +</span></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(data = prob_data_degree_coarse_stats %&gt;% filter(offense_F_MD == "Felony"), aes(x = year, y = est_prob_term_length_mo), color = "black") +</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(data = prob_data_degree_coarse_stats %&gt;% filter(offense_F_MD == "MD-PM"), aes(x = year, y = est_prob_term_length_mo, size = exits), color = "gray47") +</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(data = prob_data_degree_coarse_stats %&gt;% filter(offense_F_MD == "MD-PM"), aes(x = year, y = est_prob_term_length_mo), color = "gray47") +</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_point(aes(size = exits), pch = 21) +</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line() +</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_y_continuous("Estimated Probation Term Length (months)") +</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   scale_color_manual(name = "Offense Degree", </span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a><span class="co">#                      values = c("red","darkorange", "gold", "cyan", "dodgerblue", "gray90") #set colors manually</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a><span class="co">#                      # breaks = c("CE_BJS_survey", "CE_2024", "CX_2024"), #control the order of the labels</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a><span class="co">#                      # labels = c("Pew Method with old BJS data", "Pew Method with new CE data", "Direct method with new CX data") #customize labels</span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme_bw() +</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a><span class="co">#   theme(axis.text = element_text(size = 12)</span></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggtitle("Hawaii Probation Term Lengths Across Time") +</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a><span class="co">#   NULL</span></span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a><span class="co">#PLOT 2: fine grained plot</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prob_data_degree_fine_stats, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo, <span class="at">color =</span> OffenseDegree_categories)) <span class="sc">+</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> exits), <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Estimated Probation Term Length (months)"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Offense Degree"</span>, </span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"darkorange"</span>, <span class="st">"gold"</span>, <span class="st">"cyan"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"gray90"</span>) <span class="co">#set colors manually</span></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># breaks = c("CE_BJS_survey", "CE_2024", "CX_2024"), #control the order of the labels</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># labels = c("Pew Method with old BJS data", "Pew Method with new CE data", "Direct method with new CX data") #customize labels</span></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hawaii Probation Term Lengths Across Time"</span>) <span class="sc">+</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a><span class="co">#PLOT 3: coarse grained plot</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prob_data_degree_coarse_stats, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo, <span class="at">color =</span> offense_F_MD)) <span class="sc">+</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> exits)) <span class="sc">+</span></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Estimated Probation Term Length (months)"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Offense Degree"</span>, </span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"gray47"</span>, <span class="st">"gray90"</span>) <span class="co">#set colors manually</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># breaks = c("CE_BJS_survey", "CE_2024", "CX_2024"), #control the order of the labels</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># labels = c("Pew Method with old BJS data", "Pew Method with new CE data", "Direct method with new CX data") #customize labels</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hawaii Probation Term Lengths Across Time"</span>) <span class="sc">+</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="fig-coarse-severity" class="cell column-page quarto-layout-panel">
<figure class="figure">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-coarse-severity-1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="probation_term_length_report_2024-05-03_files/figure-html/fig-coarse-severity-1.png" class="img-fluid figure-img" data-ref-parent="fig-coarse-severity" width="576"></p>
<figcaption class="figure-caption">(a) Offense severity grouped by FA, FB, FC, MD, PM, and other</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell quarto-layout-cell-subref" style="flex-basis: 50.0%;justify-content: center;">
<div id="fig-coarse-severity-2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="probation_term_length_report_2024-05-03_files/figure-html/fig-coarse-severity-2.png" class="img-fluid figure-img" data-ref-parent="fig-coarse-severity" width="576"></p>
<figcaption class="figure-caption">(b) Offense severity grouped by F, MD-PM, and other</figcaption>
</figure>
</div>
</div>
</div>
<p></p><figcaption class="figure-caption">Figure&nbsp;7: Probation length by year and offense severity</figcaption><p></p>
</figure>
</div>
</div>
</section>
</section>
<section id="summary" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="summary"><span class="header-section-number">6</span> Summary</h2>
<p>The estimate of the probation term length based on one year of data, using an indirect method that aggregated felony and non-felony probationers and relied on data that was incomplete appears to present an inaccurate estimate of probation term length.</p>
<p>Looking at multiple years of probation data using a direct method that relies on case-level data that is stable, relatively complete and is disaggregated by offense severity suggests that probation term length may be lower than initially reported.</p>
<p>UNDER CONSTRUCTION!</p>
<section id="outstanding-issues" class="level3" data-number="6.1">
<h3 data-number="6.1" class="anchored" data-anchor-id="outstanding-issues"><span class="header-section-number">6.1</span> Outstanding issues</h3>
<section id="size-on-year-end-probation-population" class="level4" data-number="6.1.1">
<h4 data-number="6.1.1" class="anchored" data-anchor-id="size-on-year-end-probation-population"><span class="header-section-number">6.1.1</span> Size on year-end probation population</h4>
<p>UNDER CONSTRUCTION!</p>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>