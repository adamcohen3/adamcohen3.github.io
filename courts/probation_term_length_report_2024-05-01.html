<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.433">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Adam S. Cohen">
<meta name="dcterms.date" content="2024-05-01">

<title>Probation Term Length Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="probation_term_length_report_2024-05-01_files/libs/clipboard/clipboard.min.js"></script>
<script src="probation_term_length_report_2024-05-01_files/libs/quarto-html/quarto.js"></script>
<script src="probation_term_length_report_2024-05-01_files/libs/quarto-html/popper.min.js"></script>
<script src="probation_term_length_report_2024-05-01_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="probation_term_length_report_2024-05-01_files/libs/quarto-html/anchor.min.js"></script>
<link href="probation_term_length_report_2024-05-01_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="probation_term_length_report_2024-05-01_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="probation_term_length_report_2024-05-01_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="probation_term_length_report_2024-05-01_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="probation_term_length_report_2024-05-01_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background"><span class="header-section-number">1</span> Background</a></li>
  <li><a href="#probation-length-before-and-after-2018" id="toc-probation-length-before-and-after-2018" class="nav-link" data-scroll-target="#probation-length-before-and-after-2018"><span class="header-section-number">2</span> Probation length before and after 2018</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations"><span class="header-section-number">3</span> Limitations</a>
  <ul class="collapse">
  <li><a href="#l1.-pew-report-data-is-skewed-because-of-data-entry-lag" id="toc-l1.-pew-report-data-is-skewed-because-of-data-entry-lag" class="nav-link" data-scroll-target="#l1.-pew-report-data-is-skewed-because-of-data-entry-lag"><span class="header-section-number">3.1</span> L1. Pew report data is skewed because of data entry lag</a></li>
  <li><a href="#addressing-l1-using-data-that-is-stable-and-relatively-complete" id="toc-addressing-l1-using-data-that-is-stable-and-relatively-complete" class="nav-link" data-scroll-target="#addressing-l1-using-data-that-is-stable-and-relatively-complete"><span class="header-section-number">3.2</span> Addressing L1: Using data that is stable and relatively complete</a></li>
  </ul></li>
  <li><a href="#limitation-2-the-pew-method-estimates-probation-term-length-indirectly" id="toc-limitation-2-the-pew-method-estimates-probation-term-length-indirectly" class="nav-link" data-scroll-target="#limitation-2-the-pew-method-estimates-probation-term-length-indirectly"><span class="header-section-number">4</span> Limitation #2: The Pew method estimates probation term length indirectly</a></li>
  <li><a href="#fix-2-using-a-direct-method-to-estimate-probation-term-length" id="toc-fix-2-using-a-direct-method-to-estimate-probation-term-length" class="nav-link" data-scroll-target="#fix-2-using-a-direct-method-to-estimate-probation-term-length"><span class="header-section-number">5</span> Fix #2: Using a direct method to estimate probation term length</a></li>
  <li><a href="#limitation-3-the-pew-method-aggregates-felony-and-non-felony-probationers" id="toc-limitation-3-the-pew-method-aggregates-felony-and-non-felony-probationers" class="nav-link" data-scroll-target="#limitation-3-the-pew-method-aggregates-felony-and-non-felony-probationers"><span class="header-section-number">6</span> Limitation #3: The Pew method aggregates felony and non-felony probationers</a></li>
  <li><a href="#fix-3-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data" id="toc-fix-3-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data" class="nav-link" data-scroll-target="#fix-3-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data"><span class="header-section-number">7</span> Fix #3: Disaggregating felony and non-felony using a direct method and stable data</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Probation Term Length Report</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Adam S. Cohen </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">May 1, 2024</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="background" class="level2" data-number="1">
<h2 data-number="1" class="anchored" data-anchor-id="background"><span class="header-section-number">1</span> Background</h2>
<p>In 2020, Pew <a href="https://www.pewtrusts.org/en/research-and-analysis/reports/2020/12/states-can-shorten-probation-and-protect-public-safety">reported</a> that, in 2018, the state of Hawaii had the longest average probation lengths in the country at 58.9 months using data <br> <br></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Shorten_Probation_and_Public_Safety_Report_650px_Figure1.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure 1 from the 2020 Pew Report on Average Probation Lengths</figcaption>
</figure>
</div>
</section>
<section id="probation-length-before-and-after-2018" class="level2" data-number="2">
<h2 data-number="2" class="anchored" data-anchor-id="probation-length-before-and-after-2018"><span class="header-section-number">2</span> Probation length before and after 2018</h2>
<p>To provide a more complete picture of probation length in Hawaii, we analyzed data prior to 2018 and after 2018 using the same data source and method as Pew. Pew relied on data from the Bureau of Justice Statistics <a href="https://bjs.ojp.gov/data-collection/annual-probation-survey-and-annual-parole-survey">Annual Probation Survey</a> and an <em>indirect method</em> to estimate probation length (<a href="https://link.springer.com/article/10.1007/s10940-007-9037-z">Patterson &amp; Preston, 2008</a>).</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Expand to learn more about the <em>indirect method</em> used by Pew
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Estimating probation length using the indirect method described in Patterson and Preston (2008) depends on only three variables: the size of the probation population at the beginning and end of the year, along with the number of exits. These three variables are used to calculate an “exit rate,” and the inverse of this exit rate is the estimated average probation length (<a href="https://link.springer.com/article/10.1007/s10940-007-9037-z">Patterson &amp; Preston, 2008</a>).</p>
<p><span class="math display">\[probation.length = \frac{1}{exit.rate}\]</span></p>
<p><br></p>
<p><span class="math display">\[exit.rate = \frac{exits}{\frac{1}{2}*(population_{begin} + population_{end})}\]</span> To pump your intuition for why this works, consider a case where the probation population at the beginning of the year is 10,000 and by the end of the year it remains at 10,000. <br><br> First, imagine a situation where there are 10,000 exits during the year. Then, <span class="math inline">\(exit.rate = \frac{10,000}{\frac{1}{2}*(10,000+10,000)}\)</span>, which becomes <span class="math inline">\(exit.rate = 1\)</span>. Since, <span class="math inline">\(probation.length = \frac{1}{exit.rate}\)</span>, the estimated probation length is 1 year. One way to think about this is that it’s as if all 10,000 probationers from the beginning of the year came off of probation, having completed a full year at some point during the year, and 10,000 new probationers with terms of 1 year came on. <br><br> But now imagine the same situation except there are 5,000 exits. Then <span class="math inline">\(exit.rate = \frac{5,000}{\frac{1}{2}*(10,000+10,000)}\)</span>, which becomes <span class="math inline">\(exit.rate = \frac{1}{2}\)</span>. Therefore, <span class="math inline">\(probation.length = \frac{1}{1/2}\)</span>, which is 2 years. One way to think about this is that it’s as if half of the 10,000 probationers from the beginning of the year came off, having completed their second year of probation, the other half has entered their second year, and another 5,000 new probationers with terms of 2 years came on. <br><br> Or imagine the same situation except there are 20,000 exits. Then <span class="math inline">\(exit.rate = \frac{20,000}{\frac{1}{2}*(10,000+10,000)}\)</span>, which becomes <span class="math inline">\(exit.rate = 2\)</span>. Therefore, <span class="math inline">\(probation.length = \frac{1}{2}\)</span>, which is 0.5 years. One way to think about this is that it’s as if all 10,000 probationers from the beginning of the year came off of probation, having completed a 1/2 year at some point during the year, another 10,000 new probationers with terms of 1/2 year came on earlier in the year and came off before the end of the year, and another 10,000 new probationers with terms of 1/2 year came on at some point later in the year.</p>
</div>
</div>
</div>
<p>Pew reported data for 2000 and 2018 (see <span style="color:blue;">blue</span> dots in Figure 2). Here we fill in some of the gaps by providing data from the BJS Annual Probation Survey for 2012-2017 and 2019-2023.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#import data</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>bjs_prob_HI_filler <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2001</span><span class="sc">:</span><span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pop_begin =</span> <span class="fu">c</span>(<span class="dv">15707</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">22316</span>, <span class="dv">22211</span>, <span class="dv">21576</span>, <span class="dv">20931</span>, <span class="dv">20912</span>, <span class="dv">20516</span>, <span class="dv">19830</span>, <span class="dv">20196</span>, <span class="dv">19619</span>, <span class="dv">17291</span>, <span class="dv">17746</span>, <span class="dv">14341</span>),</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pop_end =</span> <span class="fu">c</span>(<span class="dv">15525</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">22211</span>, <span class="dv">21576</span>, <span class="dv">20931</span>, <span class="dv">20912</span>, <span class="dv">20516</span>,  <span class="dv">19830</span>, <span class="dv">20196</span>, <span class="dv">19619</span>, <span class="dv">17291</span>, <span class="dv">17746</span>, <span class="dv">14341</span>, <span class="dv">14538</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                          <span class="at">exits =</span> <span class="fu">c</span>(<span class="dv">6102</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">6297</span>, <span class="dv">5592</span>, <span class="dv">5303</span>, <span class="dv">5061</span>, <span class="dv">4796</span>,  <span class="dv">4557</span>, <span class="dv">4077</span>, <span class="dv">4225</span>, <span class="dv">3857</span>, <span class="dv">3981</span>, <span class="dv">5634</span>, <span class="dv">4028</span>))</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#calculate exit rate and est prob length</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>bjs_prob_HI_stats_filler <span class="ot">&lt;-</span> bjs_prob_HI_filler <span class="sc">%&gt;%</span> </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exit_rate =</span> exits<span class="sc">/</span>((pop_begin <span class="sc">+</span> pop_end)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_mo =</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">1</span><span class="sc">/</span>exit_rate,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_yr =</span> <span class="dv">1</span><span class="sc">/</span>exit_rate,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"CE_BJS_survey"</span>)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#plot data</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bjs_prob_HI_stats_filler, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo)) <span class="sc">+</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(year)), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(aes(label = paste0(janitor::round_half_up(est_prob_term_length_mo, digits = 1))), vjust = 0, nudge_y = 1, color = "gray") +</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_continuous(NULL, limits = c(2012, 2021)) +</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Estimated Probation Term Length (months)"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_hline(yintercept = 22.4, color = "red", linetype = 2, size = 1) +</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">22.4</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"National Avg, 2018</span><span class="sc">\n</span><span class="st">22.4 months"</span>) <span class="sc">+</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 2017, y = 58.9, hjust = 0, vjust = -.5, label = "HI, 2018\n58.9 months") +</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2017</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">label =</span> <span class="st">"58.9 months"</span>) <span class="sc">+</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2000</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 1999, y = 30.7, hjust = 0, vjust = -.5, label = "HI, 2000\n30.7 months") +</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1999</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">label =</span> <span class="st">"30.7 months"</span>) <span class="sc">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hawaii Probation Term Lengths Across Time"</span>) <span class="sc">+</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="probation_term_length_report_2024-05-01_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>The estimated probation length in 2018 appears to represent a peak using BJS survey data.</p>
</section>
<section id="limitations" class="level2" data-number="3">
<h2 data-number="3" class="anchored" data-anchor-id="limitations"><span class="header-section-number">3</span> Limitations</h2>
<section id="l1.-pew-report-data-is-skewed-because-of-data-entry-lag" class="level3" data-number="3.1">
<h3 data-number="3.1" class="anchored" data-anchor-id="l1.-pew-report-data-is-skewed-because-of-data-entry-lag"><span class="header-section-number">3.1</span> L1. Pew report data is skewed because of data entry lag</h3>
<p>As of April 2024, there appears to be significant data entry lag in Caseload Explorer, the case management system used by probation at the Hawaii State Judiciary. Data entry does not appear to be “stable” until 12-24 months after the end of a calendar year.</p>
<p>This was discovered when trying to re-analyze probation term lengths and discovering that the number of exits, or terminations, in a given year depends on when the analysis is run. When it is run a few months after the end of a calendar year, as it is typically done for the BJS Annual Probation Survey, there are typically 1000 to 2000 fewer terminations compared to when it is run 24 or more months later (not including 2022 or 2023, which are too recent to compare).</p>
</section>
<section id="addressing-l1-using-data-that-is-stable-and-relatively-complete" class="level3" data-number="3.2">
<h3 data-number="3.2" class="anchored" data-anchor-id="addressing-l1-using-data-that-is-stable-and-relatively-complete"><span class="header-section-number">3.2</span> Addressing L1: Using data that is stable and relatively complete</h3>
<p>To address this, the indirect method was used again but with data extracted from Caseload Explorer in April 2024. For all years except 2022 and 2023, this allowed at least 24 months after the close of the year for probation officers to complete data entry.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages -----------------------------------------------------------</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="do">##2024 DATA PULLS: exit rate and prob term length calculation --------</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>prob_HI_update <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">"Stats01_run_in_2024_CY2012-CY2023_2024-04-29.xlsx"</span>, <span class="at">col_types =</span> <span class="st">"numeric"</span>)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>prob_HI_update_stats <span class="ot">&lt;-</span> prob_HI_update <span class="sc">%&gt;%</span> </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exit_rate =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(pop_begin), exits<span class="sc">/</span>((pop_begin <span class="sc">+</span> pop_end)<span class="sc">/</span><span class="dv">2</span>), <span class="cn">NA</span>),</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_mo =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(pop_begin), <span class="dv">12</span><span class="sc">*</span><span class="dv">1</span><span class="sc">/</span>exit_rate, <span class="cn">NA</span>),</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_yr =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(pop_begin), <span class="dv">1</span><span class="sc">/</span>exit_rate, <span class="cn">NA</span>),</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"CE_2024"</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(prob_HI_update_stats, paste0("probation_term_length_results_Pew_method_CY12-CY23_", Sys.Date(), ".csv"), row.names = F)</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a><span class="co"># merge BJS old and new CE datasets ---------------------------------------------------------------</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a><span class="co">#first add empty rows for 2001:2011 &lt;- old method, now joining across all three datasets</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="cn">FALSE</span>){</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>bjs_prob_HI_filler <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">year =</span> <span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">2001</span><span class="sc">:</span><span class="dv">2011</span>, <span class="dv">2012</span>, <span class="dv">2013</span>, <span class="dv">2014</span>, <span class="dv">2015</span>, <span class="dv">2016</span>, <span class="dv">2017</span>, <span class="dv">2018</span>, <span class="dv">2019</span>, <span class="dv">2020</span>, <span class="dv">2021</span>, <span class="dv">2022</span>, <span class="dv">2023</span>),</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pop_begin =</span> <span class="fu">c</span>(<span class="dv">15707</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">22316</span>, <span class="dv">22211</span>, <span class="dv">21576</span>, <span class="dv">20931</span>, <span class="dv">20912</span>, <span class="dv">20516</span>, <span class="dv">19830</span>, <span class="dv">20196</span>, <span class="dv">19619</span>, <span class="dv">17291</span>, <span class="dv">17746</span>, <span class="dv">14341</span>),</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>                          <span class="at">pop_end =</span> <span class="fu">c</span>(<span class="dv">15525</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">22211</span>, <span class="dv">21576</span>, <span class="dv">20931</span>, <span class="dv">20912</span>, <span class="dv">20516</span>,  <span class="dv">19830</span>, <span class="dv">20196</span>, <span class="dv">19619</span>, <span class="dv">17291</span>, <span class="dv">17746</span>, <span class="dv">14341</span>, <span class="dv">14538</span>),</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>                          <span class="at">exits =</span> <span class="fu">c</span>(<span class="dv">6102</span>, <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="at">times =</span> <span class="dv">11</span>), <span class="dv">6297</span>, <span class="dv">5592</span>, <span class="dv">5303</span>, <span class="dv">5061</span>, <span class="dv">4796</span>,  <span class="dv">4557</span>, <span class="dv">4077</span>, <span class="dv">4225</span>, <span class="dv">3857</span>, <span class="dv">3981</span>, <span class="dv">5634</span>, <span class="dv">4028</span>))</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>bjs_prob_HI_stats_filler <span class="ot">&lt;-</span> bjs_prob_HI_filler <span class="sc">%&gt;%</span> </span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">exit_rate =</span> exits<span class="sc">/</span>((pop_begin <span class="sc">+</span> pop_end)<span class="sc">/</span><span class="dv">2</span>),</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_mo =</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">1</span><span class="sc">/</span>exit_rate,</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">est_prob_term_length_yr =</span> <span class="dv">1</span><span class="sc">/</span>exit_rate,</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">source =</span> <span class="st">"CE_BJS_survey"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a>merged_CE_datasets <span class="ot">&lt;-</span> bjs_prob_HI_stats_filler <span class="sc">%&gt;%</span> </span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>(prob_HI_update_stats) <span class="sc">%&gt;%</span> </span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(est_prob_term_length_yr, est_prob_term_length_mo, exit_rate), \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2012</span>)</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a><span class="co">#plot BJS and new CE data</span></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_CE_datasets, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo, <span class="at">color =</span> source)) <span class="sc">+</span></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(year)), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Estimated Probation Term Length (months)"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"darkorange"</span>), <span class="co">#set colors manually</span></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"CE_BJS_survey"</span>, <span class="st">"CE_2024"</span>), <span class="co">#control the order of the labels</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Pew Method with old BJS data"</span>, <span class="st">"Pew Method with new CE data"</span>) <span class="co">#customize labels</span></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_hline(yintercept = 22.4, color = "red", linetype = 2, size = 1) +</span></span>
<span id="cb2-55"><a href="#cb2-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">22.4</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-56"><a href="#cb2-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"National Avg, 2018</span><span class="sc">\n</span><span class="st">22.4 months"</span>) <span class="sc">+</span></span>
<span id="cb2-57"><a href="#cb2-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-58"><a href="#cb2-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 2017, y = 58.9, hjust = 0, vjust = -.5, label = "HI, 2018\n58.9 months") +</span></span>
<span id="cb2-59"><a href="#cb2-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2017</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">label =</span> <span class="st">"58.9 months"</span>) <span class="sc">+</span></span>
<span id="cb2-60"><a href="#cb2-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2000</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb2-61"><a href="#cb2-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 1999, y = 30.7, hjust = 0, vjust = -.5, label = "HI, 2000\n30.7 months") +</span></span>
<span id="cb2-62"><a href="#cb2-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1999</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">label =</span> <span class="st">"30.7 months"</span>) <span class="sc">+</span></span>
<span id="cb2-63"><a href="#cb2-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-64"><a href="#cb2-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb2-65"><a href="#cb2-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb2-66"><a href="#cb2-66" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb2-67"><a href="#cb2-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hawaii Probation Term Lengths Across Time"</span>) <span class="sc">+</span></span>
<span id="cb2-68"><a href="#cb2-68" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="probation_term_length_report_2024-05-01_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>As can be seen by the <span style="color:darkorange;">orange line</span>, the estimated probation term length appears to drop by at least 12 months if not more for years 2012-2021. Although less time has passed, there also appears to be a decrease by 4-5 months for 2022 and 2023. This suggests that probation term lengths in Hawaii may be lower than originally reported, even for the peak year of 2018.</p>
</section>
</section>
<section id="limitation-2-the-pew-method-estimates-probation-term-length-indirectly" class="level2" data-number="4">
<h2 data-number="4" class="anchored" data-anchor-id="limitation-2-the-pew-method-estimates-probation-term-length-indirectly"><span class="header-section-number">4</span> Limitation #2: The Pew method estimates probation term length indirectly</h2>
<p>Pew did not have access to individual case data, requiring them to use a method that allowed them to estimate probation term length indirectly using estimates of probation population size and number of exits. How does probation term length change, if at all, when using a direct approach that relies on calculating probation term length at the individual case level and averaging across cases?</p>
</section>
<section id="fix-2-using-a-direct-method-to-estimate-probation-term-length" class="level2" data-number="5">
<h2 data-number="5" class="anchored" data-anchor-id="fix-2-using-a-direct-method-to-estimate-probation-term-length"><span class="header-section-number">5</span> Fix #2: Using a direct method to estimate probation term length</h2>
<p>For each probationer, a probation term length was calculated by taking the difference between the start and termination of their probation term. <em>This calculation is not based on how long they were ordered to serve by a judge but by how long they actually served.</em> Each supervision case was assigned to a calendar year based on the year of the case termination. All of the individual term lengths that were grouped in a given year where then averaged to get an estimate of probation term length.</p>
<p><span class="math display">\[probationer.term.length = probation.end.date - probation.start.date\]</span> <span class="math display">\[ estimated.probation.term.length_{year} = \frac{1}{n} \sum_{i = 1}^n({probation.end.date_{i,year} - probation.start.date_{i,year}})\]</span> Where i is an individual probationer, n is the total number of probationers in a cohort, and year is a calendar year.</p>
<p>Individual case data was pulled from CX, the database underlying Caseload Explorer.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>O.Pin,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">convert</span>(<span class="dt">date</span>,O.DOB) <span class="kw">AS</span> DOB,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>O.Gender,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>O.LastName,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>O.FirstName,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetPersonAttributeValue(O.PersonId, <span class="kw">NULL</span>, <span class="st">'Person_SID'</span>) <span class="kw">AS</span> SID,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'Sup lvl'</span>) <span class="kw">AS</span> SupervisionLevel, <span class="co">--current/active/most recent supervision level</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>A3.firstSupLevel <span class="kw">AS</span> InitialSupervisionLevel, <span class="co">--initial supervision level</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>C.Name <span class="kw">AS</span> <span class="st">'Caseload Name'</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'CASE_SpecialGroups'</span>) <span class="kw">AS</span> SpecialGroups,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>(<span class="kw">LEFT</span>(CX.dbo.GetCaseAttributeValue(CA.ParentCaseId, <span class="kw">NULL</span>, <span class="st">'CourtCircuit'</span>), <span class="dv">1</span>) <span class="op">+</span> <span class="st">'/'</span> <span class="op">+</span> <span class="kw">LEFT</span>(CX.dbo.GetCaseAttributeValue(CA.ParentCaseId, <span class="kw">NULL</span>, <span class="st">'Court'</span>), <span class="dv">1</span>)) <span class="kw">AS</span> CircuitCourt,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>CA.ChildCaseId,</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>CA.ParentCaseId,</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>CC.CaseNumber <span class="kw">AS</span> docCaseNumber, <span class="co">--Parent/Docket Case #</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">Child</span>.CaseNumber <span class="kw">AS</span> supCaseNumber, <span class="co">--Child/Supervision Case #</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>CT.Name <span class="kw">as</span> <span class="st">'Case Type'</span>,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'Termination'</span>) <span class="kw">AS</span> Termination,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'TerminationDate'</span>) <span class="kw">AS</span> TerminationDate,</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">convert</span>(<span class="dt">date</span>,<span class="kw">Child</span>.StartDate) <span class="kw">as</span> <span class="st">'Supervision Start Date'</span>, <span class="co">--current/active/most recent supervision level</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>A1.minStartDate <span class="kw">AS</span> HistoricalSupervisionStartDate, <span class="co">--historical supervision start date</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="fu">convert</span>(<span class="dt">date</span>,CC.CloseDateTime) <span class="kw">AS</span> CloseDateTime,</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>X.TypeName <span class="kw">as</span> <span class="st">'Charge Type'</span>,</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>X.StatuteDescription,</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>X.OffenseLevel,</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>X.OffenseCode,</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>X.OffenseDegree,</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>X.OffenseDescription,</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>CG.ChargeId,</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetChargeAttributeValue(CG.ChargeId, <span class="kw">NULL</span>, <span class="st">'Dispo'</span>) <span class="kw">As</span> Disposition,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>CX.dbo.GetChargeAttributeValue(CG.ChargeId, <span class="kw">NULL</span>, <span class="st">'DispositionDate'</span>) <span class="kw">As</span> DispositionDate</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>CX.dbo.OffenderInfo O</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CourtCase CC <span class="kw">on</span> o.<span class="kw">Id</span> <span class="op">=</span> CC.OffenderId</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CaseCase CA <span class="kw">on</span> Ca.ParentCaseId <span class="op">=</span> CC.<span class="kw">Id</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CourtCase <span class="kw">Child</span> <span class="kw">on</span> <span class="kw">Child</span>.<span class="kw">Id</span> <span class="op">=</span> CA.ChildCaseId</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CaseType CT <span class="kw">on</span> CT.<span class="kw">Id</span> <span class="op">=</span> <span class="kw">Child</span>.CaseTypeId</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.Caseload C <span class="kw">ON</span> C.<span class="kw">Id</span> <span class="op">=</span> O.CaseloadId</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> (<span class="kw">SELECT</span> CaseId, <span class="fu">MIN</span>(<span class="fu">Value</span>) <span class="kw">AS</span> minStartDate <span class="kw">FROM</span> CX.dbo.CaseAttribute <span class="kw">WHERE</span> AttributeId <span class="op">=</span> <span class="dv">3956</span> <span class="kw">GROUP</span> <span class="kw">BY</span> CaseId) A1 <span class="kw">ON</span> A1.CaseId <span class="op">=</span> CA.ChildCaseId <span class="co">--AttributeId = 3956 -&gt; attributeId for start date</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> (<span class="kw">SELECT</span> CaseId, <span class="fu">MIN</span>(FromTime) <span class="kw">AS</span> minFromTime <span class="kw">FROM</span> CX.dbo.CaseAttribute <span class="kw">WHERE</span> AttributeId <span class="op">=</span> <span class="dv">87</span> <span class="kw">GROUP</span> <span class="kw">BY</span> CaseId) A2 <span class="kw">ON</span> A2.CaseId <span class="op">=</span> CA.ChildCaseId <span class="co">--AttributeId = 87 -&gt; attributeId for supervision level</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> (<span class="kw">SELECT</span> CaseId, FromTime, <span class="fu">Value</span> <span class="kw">AS</span> firstSupLevel <span class="kw">FROM</span> CX.dbo.CaseAttribute <span class="kw">WHERE</span> AttributeId <span class="op">=</span> <span class="dv">87</span>) A3 <span class="kw">ON</span> A3.CaseId <span class="op">=</span> CA.ChildCaseId <span class="kw">AND</span> A3.FromTime <span class="op">=</span> A2.minFromTime</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a><span class="kw">JOIN</span> CX.dbo.CaseCharge CG <span class="kw">ON</span> Ca.ParentCaseId <span class="op">=</span> CG.CaseId <span class="co">--on CC.Id/Parent CaseId b/c charges stored at docket level</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a><span class="kw">Outer</span> Apply (<span class="kw">Select</span> S.OffenseLevel, OffenseCode, OffenseDegree, OffenseDescription, CCh.TypeName, CCH.StatuteDescription <span class="kw">from</span> CX.dbo.Statute s <span class="kw">join</span> CX.dbo.charge ch <span class="kw">on</span> s.<span class="kw">Id</span> <span class="op">=</span> ch.statuteid <span class="kw">join</span> CX.Hawaii.CaseChargeInfo cch <span class="kw">on</span> cch.<span class="kw">Id</span> <span class="op">=</span> ch.<span class="kw">id</span> <span class="kw">where</span> cch.caseid <span class="op">=</span> cc.<span class="kw">id</span> <span class="kw">AND</span> CG.ChargeId <span class="op">=</span> ch.<span class="kw">id</span>) X</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> </span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a><span class="co">--convert TerminationDate to date type in order to filter by date; h/t: https://stackoverflow.com/questions/14397569/filter-data-based-on-date-in-sql; h/t: https://stackoverflow.com/questions/1334143/datetime2-vs-datetime-in-sql-server</span></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>(<span class="fu">CONVERT</span>(<span class="dt">date</span>,CX.dbo.GetCaseAttributeValue(CA.ChildCaseId, <span class="kw">NULL</span>, <span class="st">'TerminationDate'</span>)) <span class="kw">BETWEEN</span> <span class="st">'1/1/2000'</span> <span class="kw">AND</span> <span class="st">'12/31/2023'</span>)  <span class="co">--filter by supervision termination date</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a><span class="kw">AND</span> CT.<span class="kw">Id</span> <span class="op">=</span> <span class="dv">39</span> <span class="co">--supervision code</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> LastName</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Here are the direct estimates of probation term length plotted against the indirect method using the old BJS data and the new CE data.</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="co"># load packages -----------------------------------------------------------</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="co"># import data -------------------------------------------------------------</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>prob_data <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"probation_term_length_extract_CY00-CY23_2024-04-29.csv"</span>)</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#Direct Method: case-level data compute data --------------------------------------------------------------</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>prob_data_clean <span class="ot">&lt;-</span> prob_data <span class="sc">%&gt;%</span> </span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_start =</span> <span class="fu">strptime</span>(HistoricalSupervisionStartDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_term =</span> <span class="fu">strptime</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_days =</span> <span class="fu">difftime</span>(prob_term, prob_start, <span class="at">units =</span> <span class="st">"days"</span>),</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_yrs =</span> <span class="fu">as.double</span>(prob_length_days)<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">cyear =</span> <span class="fu">as.factor</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),<span class="st">"%Y"</span>))</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># QA1 do start and end dates vary within a supervision case? --------------</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a><span class="co">#Yes -&gt; about 30 cases, at least two instances where case was opened in error/duplicate</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>QA1 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA1){</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>  term_length_variation <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> </span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">term_variation =</span> <span class="fu">sd</span>(prob_length_days)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>()</span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: Remarks - Duplicate case in CE.</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  test1 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP-06-1-0998-1'</span>)</span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: Remarks - Duplicate Entry</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  test2 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP 2FFC-17-0000072'</span>)</span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: note clear...</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a>  test3 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP-03-0414-1'</span>)</span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a><span class="co"># QA2: duplicate rows -----------------------------------------------------</span></span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a><span class="co">#multiple charges</span></span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>QA2 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA2){</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>  test1 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(LastName <span class="sc">==</span> <span class="st">"Ababa"</span>)</span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>  test1 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="dv">426999</span>)</span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a><span class="co"># clean data --------------------------------------------------------------</span></span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a><span class="co">#step 1: remove duplicates -&gt; often due to multiple charges, sometimes multiple dispo dates, multiplying rows</span></span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>prob_data_clean2 <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="co">#%&gt;% </span></span>
<span id="cb4-65"><a href="#cb4-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># arrange(desc(prob_length_yrs))</span></span>
<span id="cb4-66"><a href="#cb4-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-67"><a href="#cb4-67" aria-hidden="true" tabindex="-1"></a><span class="co">#QA2.1: check the test cases from above with variation in term length, check that it's pulling the longest term -&gt; conservative----</span></span>
<span id="cb4-68"><a href="#cb4-68" aria-hidden="true" tabindex="-1"></a>QA2<span class="fl">.1</span> <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb4-69"><a href="#cb4-69" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA2<span class="fl">.1</span>){</span>
<span id="cb4-70"><a href="#cb4-70" aria-hidden="true" tabindex="-1"></a>  test1b <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb4-71"><a href="#cb4-71" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP-06-1-0998-1'</span>)</span>
<span id="cb4-72"><a href="#cb4-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-73"><a href="#cb4-73" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: Remarks - Duplicate Entry</span></span>
<span id="cb4-74"><a href="#cb4-74" aria-hidden="true" tabindex="-1"></a>  test2b <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb4-75"><a href="#cb4-75" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP 2FFC-17-0000072'</span>)</span>
<span id="cb4-76"><a href="#cb4-76" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-77"><a href="#cb4-77" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Research in CE: note clear...</span></span>
<span id="cb4-78"><a href="#cb4-78" aria-hidden="true" tabindex="-1"></a>  test3b <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb4-79"><a href="#cb4-79" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(supCaseNumber <span class="sc">==</span> <span class="st">'SP-03-0414-1'</span>)</span>
<span id="cb4-80"><a href="#cb4-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-81"><a href="#cb4-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-82"><a href="#cb4-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-83"><a href="#cb4-83" aria-hidden="true" tabindex="-1"></a><span class="co"># QA3: negative term lengths ----------------------------------------------</span></span>
<span id="cb4-84"><a href="#cb4-84" aria-hidden="true" tabindex="-1"></a>QA3 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb4-85"><a href="#cb4-85" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA3){</span>
<span id="cb4-86"><a href="#cb4-86" aria-hidden="true" tabindex="-1"></a>  neg_term_lengths <span class="ot">&lt;-</span> prob_data_clean <span class="sc">%&gt;%</span> </span>
<span id="cb4-87"><a href="#cb4-87" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(prob_length_days <span class="sc">&lt;</span> <span class="dv">0</span>)</span>
<span id="cb4-88"><a href="#cb4-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-89"><a href="#cb4-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-90"><a href="#cb4-90" aria-hidden="true" tabindex="-1"></a>  prob_data_clean3 <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb4-91"><a href="#cb4-91" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(prob_length_days <span class="sc">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb4-92"><a href="#cb4-92" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-93"><a href="#cb4-93" aria-hidden="true" tabindex="-1"></a>  <span class="co">#boxplot</span></span>
<span id="cb4-94"><a href="#cb4-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(prob_data_clean3, <span class="fu">aes</span>(<span class="at">x =</span> cyear, <span class="at">y =</span> prob_length_yrs, <span class="at">fill =</span> cyear)) <span class="sc">+</span></span>
<span id="cb4-95"><a href="#cb4-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scale_fill_brewer(type = "qual", palette = 1) +</span></span>
<span id="cb4-96"><a href="#cb4-96" aria-hidden="true" tabindex="-1"></a>    <span class="co"># geom_jitter(color="gray27", size=0.3, alpha=0.3) +</span></span>
<span id="cb4-97"><a href="#cb4-97" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_boxplot</span>(<span class="at">outlier.shape =</span> <span class="cn">NA</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb4-98"><a href="#cb4-98" aria-hidden="true" tabindex="-1"></a>    <span class="cn">NULL</span></span>
<span id="cb4-99"><a href="#cb4-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-100"><a href="#cb4-100" aria-hidden="true" tabindex="-1"></a><span class="co">#violin</span></span>
<span id="cb4-101"><a href="#cb4-101" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prob_data_clean3, <span class="fu">aes</span>(<span class="at">x =</span> cyear, <span class="at">y =</span> prob_length_yrs, <span class="at">fill =</span> cyear)) <span class="sc">+</span></span>
<span id="cb4-102"><a href="#cb4-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb4-103"><a href="#cb4-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_brewer(type = "qual", palette = 1) +</span></span>
<span id="cb4-104"><a href="#cb4-104" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_jitter(color="black", size=0.3, alpha=0.1) +</span></span>
<span id="cb4-105"><a href="#cb4-105" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb4-106"><a href="#cb4-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-107"><a href="#cb4-107" aria-hidden="true" tabindex="-1"></a><span class="co">#histo</span></span>
<span id="cb4-108"><a href="#cb4-108" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prob_data_clean3, <span class="fu">aes</span>(<span class="at">x =</span> prob_length_yrs, <span class="at">fill =</span> cyear)) <span class="sc">+</span></span>
<span id="cb4-109"><a href="#cb4-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">binwidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-110"><a href="#cb4-110" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_fill_brewer(type = "qual", palette = 1) +</span></span>
<span id="cb4-111"><a href="#cb4-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb4-112"><a href="#cb4-112" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>cyear)</span>
<span id="cb4-113"><a href="#cb4-113" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span>
<span id="cb4-114"><a href="#cb4-114" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-115"><a href="#cb4-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-116"><a href="#cb4-116" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-117"><a href="#cb4-117" aria-hidden="true" tabindex="-1"></a><span class="co"># descriptive stats -------------------------------------------------------</span></span>
<span id="cb4-118"><a href="#cb4-118" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-119"><a href="#cb4-119" aria-hidden="true" tabindex="-1"></a><span class="co">#count persons, include negative length terms &lt;- need to be fixed by probation staff</span></span>
<span id="cb4-120"><a href="#cb4-120" aria-hidden="true" tabindex="-1"></a>prob_data_stats <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb4-121"><a href="#cb4-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(prob_length_yrs &lt; 20) %&gt;% #exploratory analysis filtering out outliars</span></span>
<span id="cb4-122"><a href="#cb4-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyear) <span class="sc">%&gt;%</span> </span>
<span id="cb4-123"><a href="#cb4-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_of_probationers =</span> <span class="fu">n</span>(),</span>
<span id="cb4-124"><a href="#cb4-124" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_yr =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T), </span>
<span id="cb4-125"><a href="#cb4-125" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_yr =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb4-126"><a href="#cb4-126" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_yr =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb4-127"><a href="#cb4-127" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_mo =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>, </span>
<span id="cb4-128"><a href="#cb4-128" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_mo =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>,</span>
<span id="cb4-129"><a href="#cb4-129" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_mo =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb4-130"><a href="#cb4-130" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>  </span>
<span id="cb4-131"><a href="#cb4-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-132"><a href="#cb4-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(mean_yr<span class="sc">:</span>sd_mo, \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>)),</span>
<span id="cb4-133"><a href="#cb4-133" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_probation_term_length =</span> <span class="fu">paste0</span>(mean_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, mean_mo, <span class="st">" months)"</span>),</span>
<span id="cb4-134"><a href="#cb4-134" aria-hidden="true" tabindex="-1"></a>         <span class="at">median_probation_term_length =</span> <span class="fu">paste0</span>(median_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, median_mo, <span class="st">" months)"</span>),</span>
<span id="cb4-135"><a href="#cb4-135" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_probation_term_length =</span> <span class="fu">paste0</span>(sd_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, sd_mo, <span class="st">" months)"</span>)</span>
<span id="cb4-136"><a href="#cb4-136" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb4-137"><a href="#cb4-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">calendar_year =</span> cyear, number_of_probationers, mean_mo, mean_yr, mean_probation_term_length<span class="sc">:</span>sd_probation_term_length)</span>
<span id="cb4-138"><a href="#cb4-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-139"><a href="#cb4-139" aria-hidden="true" tabindex="-1"></a><span class="co"># write.csv(prob_data_stats, paste0("probation_term_length_CY14-CY23_results_", Sys.Date(), ".csv"), row.names = F)</span></span>
<span id="cb4-140"><a href="#cb4-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-141"><a href="#cb4-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-142"><a href="#cb4-142" aria-hidden="true" tabindex="-1"></a><span class="co"># QA4: Comparing old vs new data pulls ------------------------------------</span></span>
<span id="cb4-143"><a href="#cb4-143" aria-hidden="true" tabindex="-1"></a>QA4 <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb4-144"><a href="#cb4-144" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(QA4){</span>
<span id="cb4-145"><a href="#cb4-145" aria-hidden="true" tabindex="-1"></a>prob_data_2024_02_06 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"probation_term_length_extract_CY00-CY23_2024-02-06.csv"</span>)</span>
<span id="cb4-146"><a href="#cb4-146" aria-hidden="true" tabindex="-1"></a>prob_data_clean_2024_02_06 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> </span>
<span id="cb4-147"><a href="#cb4-147" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_start =</span> <span class="fu">strptime</span>(HistoricalSupervisionStartDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb4-148"><a href="#cb4-148" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_term =</span> <span class="fu">strptime</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb4-149"><a href="#cb4-149" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_days =</span> <span class="fu">difftime</span>(prob_term, prob_start, <span class="at">units =</span> <span class="st">"days"</span>),</span>
<span id="cb4-150"><a href="#cb4-150" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_yrs =</span> <span class="fu">as.double</span>(prob_length_days)<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb4-151"><a href="#cb4-151" aria-hidden="true" tabindex="-1"></a>         <span class="at">cyear =</span> <span class="fu">as.factor</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),<span class="st">"%Y"</span>))</span>
<span id="cb4-152"><a href="#cb4-152" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-153"><a href="#cb4-153" aria-hidden="true" tabindex="-1"></a><span class="co"># prob_data_clean2_2024_02_06 &lt;- prob_data_clean_2024_02_06 %&gt;% </span></span>
<span id="cb4-154"><a href="#cb4-154" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb4-155"><a href="#cb4-155" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;% </span></span>
<span id="cb4-156"><a href="#cb4-156" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() </span></span>
<span id="cb4-157"><a href="#cb4-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-158"><a href="#cb4-158" aria-hidden="true" tabindex="-1"></a>prob_data_2024_03_19 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"probation_term_length_extract_CY00-CY23_2024-03-19.csv"</span>)</span>
<span id="cb4-159"><a href="#cb4-159" aria-hidden="true" tabindex="-1"></a>prob_data_clean_2024_03_19 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> </span>
<span id="cb4-160"><a href="#cb4-160" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_start =</span> <span class="fu">strptime</span>(HistoricalSupervisionStartDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb4-161"><a href="#cb4-161" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_term =</span> <span class="fu">strptime</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb4-162"><a href="#cb4-162" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_days =</span> <span class="fu">difftime</span>(prob_term, prob_start, <span class="at">units =</span> <span class="st">"days"</span>),</span>
<span id="cb4-163"><a href="#cb4-163" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_yrs =</span> <span class="fu">as.double</span>(prob_length_days)<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb4-164"><a href="#cb4-164" aria-hidden="true" tabindex="-1"></a>         <span class="at">cyear =</span> <span class="fu">as.factor</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),<span class="st">"%Y"</span>))</span>
<span id="cb4-165"><a href="#cb4-165" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-166"><a href="#cb4-166" aria-hidden="true" tabindex="-1"></a><span class="co"># prob_data_clean2_2024_03_19 &lt;- prob_data_clean_2024_03_19 %&gt;% </span></span>
<span id="cb4-167"><a href="#cb4-167" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb4-168"><a href="#cb4-168" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;% </span></span>
<span id="cb4-169"><a href="#cb4-169" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()  </span></span>
<span id="cb4-170"><a href="#cb4-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-171"><a href="#cb4-171" aria-hidden="true" tabindex="-1"></a>prob_data_2024_04_03 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"probation_term_length_extract_CY00-CY23_2024-04-03.csv"</span>)</span>
<span id="cb4-172"><a href="#cb4-172" aria-hidden="true" tabindex="-1"></a>prob_data_clean_2024_04_03 <span class="ot">&lt;-</span> prob_data_2024_04_03 <span class="sc">%&gt;%</span> </span>
<span id="cb4-173"><a href="#cb4-173" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prob_start =</span> <span class="fu">strptime</span>(HistoricalSupervisionStartDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb4-174"><a href="#cb4-174" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_term =</span> <span class="fu">strptime</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),</span>
<span id="cb4-175"><a href="#cb4-175" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_days =</span> <span class="fu">difftime</span>(prob_term, prob_start, <span class="at">units =</span> <span class="st">"days"</span>),</span>
<span id="cb4-176"><a href="#cb4-176" aria-hidden="true" tabindex="-1"></a>         <span class="at">prob_length_yrs =</span> <span class="fu">as.double</span>(prob_length_days)<span class="sc">/</span><span class="dv">365</span>,</span>
<span id="cb4-177"><a href="#cb4-177" aria-hidden="true" tabindex="-1"></a>         <span class="at">cyear =</span> <span class="fu">as.factor</span>(<span class="fu">format</span>(<span class="fu">as.Date</span>(TerminationDate, <span class="st">"%m/%d/%Y"</span>),<span class="st">"%Y"</span>))</span>
<span id="cb4-178"><a href="#cb4-178" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-179"><a href="#cb4-179" aria-hidden="true" tabindex="-1"></a><span class="co"># prob_data_clean2_2024_04_03 &lt;- prob_data_clean_2024_04_03 %&gt;% </span></span>
<span id="cb4-180"><a href="#cb4-180" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb4-181"><a href="#cb4-181" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;% </span></span>
<span id="cb4-182"><a href="#cb4-182" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup() </span></span>
<span id="cb4-183"><a href="#cb4-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-184"><a href="#cb4-184" aria-hidden="true" tabindex="-1"></a>anti_join_02_to_03 <span class="ot">&lt;-</span> prob_data_clean_2024_02_06 <span class="sc">%&gt;%</span> </span>
<span id="cb4-185"><a href="#cb4-185" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Caseload.Name, <span class="sc">-</span>SpecialGroups) <span class="sc">%&gt;%</span> <span class="co">#caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb4-186"><a href="#cb4-186" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(prob_data_clean_2024_03_19) <span class="sc">%&gt;%</span> </span>
<span id="cb4-187"><a href="#cb4-187" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb4-188"><a href="#cb4-188" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-189"><a href="#cb4-189" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-190"><a href="#cb4-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-191"><a href="#cb4-191" aria-hidden="true" tabindex="-1"></a>anti_join_03_to_02 <span class="ot">&lt;-</span> prob_data_clean_2024_03_19 <span class="sc">%&gt;%</span></span>
<span id="cb4-192"><a href="#cb4-192" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Caseload.Name, <span class="sc">-</span>SpecialGroups) <span class="sc">%&gt;%</span> <span class="co">#caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb4-193"><a href="#cb4-193" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(prob_data_clean_2024_02_06) <span class="sc">%&gt;%</span></span>
<span id="cb4-194"><a href="#cb4-194" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb4-195"><a href="#cb4-195" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-196"><a href="#cb4-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-197"><a href="#cb4-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-198"><a href="#cb4-198" aria-hidden="true" tabindex="-1"></a><span class="co"># anti_join_03_to_04 &lt;- prob_data_clean_2024_03_19 %&gt;% </span></span>
<span id="cb4-199"><a href="#cb4-199" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-Caseload.Name, -SpecialGroups) %&gt;% #caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb4-200"><a href="#cb4-200" aria-hidden="true" tabindex="-1"></a><span class="co">#   anti_join(prob_data_clean_2024_04_03) %&gt;% </span></span>
<span id="cb4-201"><a href="#cb4-201" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb4-202"><a href="#cb4-202" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;%</span></span>
<span id="cb4-203"><a href="#cb4-203" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb4-204"><a href="#cb4-204" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb4-205"><a href="#cb4-205" aria-hidden="true" tabindex="-1"></a><span class="co"># anti_join_04_to_03 &lt;- prob_data_clean_2024_04_03 %&gt;% </span></span>
<span id="cb4-206"><a href="#cb4-206" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(-Caseload.Name, -SpecialGroups) %&gt;% #caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb4-207"><a href="#cb4-207" aria-hidden="true" tabindex="-1"></a><span class="co">#   anti_join(prob_data_clean_2024_03_19) %&gt;% </span></span>
<span id="cb4-208"><a href="#cb4-208" aria-hidden="true" tabindex="-1"></a><span class="co">#   group_by(Pin, supCaseNumber) %&gt;% #count cases, not persons</span></span>
<span id="cb4-209"><a href="#cb4-209" aria-hidden="true" tabindex="-1"></a><span class="co">#   slice_max(prob_length_days, n = 1, with_ties = FALSE) %&gt;%</span></span>
<span id="cb4-210"><a href="#cb4-210" aria-hidden="true" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb4-211"><a href="#cb4-211" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-212"><a href="#cb4-212" aria-hidden="true" tabindex="-1"></a>anti_join_02_to_04 <span class="ot">&lt;-</span> prob_data_clean_2024_02_06 <span class="sc">%&gt;%</span> </span>
<span id="cb4-213"><a href="#cb4-213" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Caseload.Name, <span class="sc">-</span>SpecialGroups) <span class="sc">%&gt;%</span> <span class="co">#caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb4-214"><a href="#cb4-214" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(prob_data_clean_2024_04_03, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Pin"</span>, <span class="st">"ChildCaseId"</span>, <span class="st">"prob_start"</span>, <span class="st">"prob_term"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-215"><a href="#cb4-215" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb4-216"><a href="#cb4-216" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-217"><a href="#cb4-217" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-218"><a href="#cb4-218" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-219"><a href="#cb4-219" aria-hidden="true" tabindex="-1"></a>anti_join_04_to_02 <span class="ot">&lt;-</span> prob_data_clean_2024_04_03 <span class="sc">%&gt;%</span></span>
<span id="cb4-220"><a href="#cb4-220" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Caseload.Name, <span class="sc">-</span>SpecialGroups) <span class="sc">%&gt;%</span> <span class="co">#caseload name can change to NULL after case closes, so ignore this</span></span>
<span id="cb4-221"><a href="#cb4-221" aria-hidden="true" tabindex="-1"></a>  <span class="co"># anti_join(prob_data_clean_2024_02_06) %&gt;%</span></span>
<span id="cb4-222"><a href="#cb4-222" aria-hidden="true" tabindex="-1"></a>  <span class="fu">anti_join</span>(prob_data_clean_2024_02_06, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Pin"</span>, <span class="st">"ChildCaseId"</span>, <span class="st">"prob_start"</span>, <span class="st">"prob_term"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-223"><a href="#cb4-223" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Pin, supCaseNumber) <span class="sc">%&gt;%</span> <span class="co">#count cases, not persons</span></span>
<span id="cb4-224"><a href="#cb4-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_max</span>(prob_length_days, <span class="at">n =</span> <span class="dv">1</span>, <span class="at">with_ties =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-225"><a href="#cb4-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-226"><a href="#cb4-226" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-227"><a href="#cb4-227" aria-hidden="true" tabindex="-1"></a>anti_join_04_to_02 <span class="sc">%&gt;%</span> </span>
<span id="cb4-228"><a href="#cb4-228" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(cyear)</span>
<span id="cb4-229"><a href="#cb4-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-230"><a href="#cb4-230" aria-hidden="true" tabindex="-1"></a><span class="co">#example 1: case term in 9/23 but entered in CE on 02/24</span></span>
<span id="cb4-231"><a href="#cb4-231" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"518058"</span>)</span>
<span id="cb4-232"><a href="#cb4-232" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"518058"</span>)</span>
<span id="cb4-233"><a href="#cb4-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-234"><a href="#cb4-234" aria-hidden="true" tabindex="-1"></a><span class="co">#example 2 -&gt; couldn't figure out...hold up:</span></span>
<span id="cb4-235"><a href="#cb4-235" aria-hidden="true" tabindex="-1"></a><span class="co"># Id    OffenderId  EnteredByPId    FromTime    CaseNumber  CloseDateTime   CaseTypeId  BookingId   StartDate   EndDate JurisdictionLId DispositionId   Sealed  LastModified    REC_ID</span></span>
<span id="cb4-236"><a href="#cb4-236" aria-hidden="true" tabindex="-1"></a><span class="co"># 697576    176995  111855  2023-06-07 15:27:54.143 SP 5DTC-23-000801-1 2023-12-08 11:08:00.000 39  NULL    2023-06-06 00:00:00.000 2023-12-05 00:00:00.000 NULL    NULL    0   2024-02-09 12:36:41.943 NULL</span></span>
<span id="cb4-237"><a href="#cb4-237" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"579792"</span>)</span>
<span id="cb4-238"><a href="#cb4-238" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"579792"</span>)</span>
<span id="cb4-239"><a href="#cb4-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-240"><a href="#cb4-240" aria-hidden="true" tabindex="-1"></a><span class="co">#example 3: case term in 6/21 but entered in CE on 03/24</span></span>
<span id="cb4-241"><a href="#cb4-241" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"579792"</span>)</span>
<span id="cb4-242"><a href="#cb4-242" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"579792"</span>)</span>
<span id="cb4-243"><a href="#cb4-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-244"><a href="#cb4-244" aria-hidden="true" tabindex="-1"></a><span class="co">#example 4: case term in 11/23 but entered in CE on 03/24</span></span>
<span id="cb4-245"><a href="#cb4-245" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"569710"</span>)</span>
<span id="cb4-246"><a href="#cb4-246" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"569710"</span>)</span>
<span id="cb4-247"><a href="#cb4-247" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-248"><a href="#cb4-248" aria-hidden="true" tabindex="-1"></a><span class="co">#example 5: case term in 04/23 but entered in CE on 03/24</span></span>
<span id="cb4-249"><a href="#cb4-249" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"512076"</span>)</span>
<span id="cb4-250"><a href="#cb4-250" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"512076"</span>)</span>
<span id="cb4-251"><a href="#cb4-251" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-252"><a href="#cb4-252" aria-hidden="true" tabindex="-1"></a><span class="co">#example 6: formatting of docCaseNumber got converted into a date for 2024/02/06, import issue?</span></span>
<span id="cb4-253"><a href="#cb4-253" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"513305"</span>)</span>
<span id="cb4-254"><a href="#cb4-254" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"513305"</span>)</span>
<span id="cb4-255"><a href="#cb4-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-256"><a href="#cb4-256" aria-hidden="true" tabindex="-1"></a><span class="co">#example 7: there was a change in Special Group, was showing up in 2 but not 3, fixed select to exclude SpecialGroups</span></span>
<span id="cb4-257"><a href="#cb4-257" aria-hidden="true" tabindex="-1"></a>tmp_02 <span class="ot">&lt;-</span> prob_data_2024_02_06 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"2992"</span>)</span>
<span id="cb4-258"><a href="#cb4-258" aria-hidden="true" tabindex="-1"></a>tmp_03 <span class="ot">&lt;-</span> prob_data_2024_03_19 <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Pin <span class="sc">==</span> <span class="st">"2992"</span>)</span>
<span id="cb4-259"><a href="#cb4-259" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-260"><a href="#cb4-260" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-261"><a href="#cb4-261" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-262"><a href="#cb4-262" aria-hidden="true" tabindex="-1"></a><span class="co"># merge three datasets ---------------------------------------------------------------</span></span>
<span id="cb4-263"><a href="#cb4-263" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-264"><a href="#cb4-264" aria-hidden="true" tabindex="-1"></a>merge_method <span class="ot">&lt;-</span> <span class="st">"bind_row_method"</span></span>
<span id="cb4-265"><a href="#cb4-265" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(merge_method <span class="sc">==</span> <span class="st">"join_method"</span>){</span>
<span id="cb4-266"><a href="#cb4-266" aria-hidden="true" tabindex="-1"></a>  <span class="co">#step 1a - join BJS (CE) data, new CE data, and new CX data</span></span>
<span id="cb4-267"><a href="#cb4-267" aria-hidden="true" tabindex="-1"></a>  merged_datasets <span class="ot">&lt;-</span> bjs_prob_HI_stats_filler <span class="sc">%&gt;%</span> </span>
<span id="cb4-268"><a href="#cb4-268" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(prob_HI_update_stats, <span class="at">by =</span> <span class="st">"year"</span>, <span class="at">suffix =</span> <span class="fu">c</span>(<span class="st">"_bjs_CE"</span>, <span class="st">"_ac_CE"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-269"><a href="#cb4-269" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.factor</span>(year)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-270"><a href="#cb4-270" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(prob_data_stats, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"year"</span><span class="ot">=</span><span class="st">"calendar_year"</span>))</span>
<span id="cb4-271"><a href="#cb4-271" aria-hidden="true" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>(merge_method <span class="sc">==</span> <span class="st">"bind_row_method"</span>){</span>
<span id="cb4-272"><a href="#cb4-272" aria-hidden="true" tabindex="-1"></a>  <span class="co">#step 1b - row bind BJS (CE) data, new CE data, and new CX data</span></span>
<span id="cb4-273"><a href="#cb4-273" aria-hidden="true" tabindex="-1"></a>  merged_datasets <span class="ot">&lt;-</span> prob_data_stats <span class="sc">%&gt;%</span> </span>
<span id="cb4-274"><a href="#cb4-274" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="at">year =</span> calendar_year, <span class="at">exits =</span> number_of_probationers, <span class="at">est_prob_term_length_yr =</span> mean_yr, <span class="at">est_prob_term_length_mo =</span> mean_mo) <span class="sc">%&gt;%</span> </span>
<span id="cb4-275"><a href="#cb4-275" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">levels</span>(year))[year],</span>
<span id="cb4-276"><a href="#cb4-276" aria-hidden="true" tabindex="-1"></a>           <span class="at">source =</span> <span class="st">"CX_2024"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-277"><a href="#cb4-277" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(bjs_prob_HI_stats_filler, prob_HI_update_stats) <span class="sc">%&gt;%</span> </span>
<span id="cb4-278"><a href="#cb4-278" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(est_prob_term_length_yr, est_prob_term_length_mo, exit_rate), \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-279"><a href="#cb4-279" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2012</span>)</span>
<span id="cb4-280"><a href="#cb4-280" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-281"><a href="#cb4-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-282"><a href="#cb4-282" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-283"><a href="#cb4-283" aria-hidden="true" tabindex="-1"></a><span class="co"># plot data ---------------------------------------------------------------</span></span>
<span id="cb4-284"><a href="#cb4-284" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb4-285"><a href="#cb4-285" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(merged_datasets, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo, <span class="at">color =</span> source)) <span class="sc">+</span></span>
<span id="cb4-286"><a href="#cb4-286" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb4-287"><a href="#cb4-287" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb4-288"><a href="#cb4-288" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_line(data = prob_HI_update_stats, aes(x = year, y = est_prob_term_length_mo), </span></span>
<span id="cb4-289"><a href="#cb4-289" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           color = "orange",</span></span>
<span id="cb4-290"><a href="#cb4-290" aria-hidden="true" tabindex="-1"></a>  <span class="co">#           alpha = if_else(prob_HI_update_stats$year &gt;= 2021, 0.3, 1)) +</span></span>
<span id="cb4-291"><a href="#cb4-291" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_point(data = prob_HI_update_stats, #data = prob_HI_update_stats %&gt;% filter(year &gt;= 2012), </span></span>
<span id="cb4-292"><a href="#cb4-292" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            # aes(x = year, y = est_prob_term_length_mo, alpha = -year, size = year), </span></span>
<span id="cb4-293"><a href="#cb4-293" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            aes(x = year, y = est_prob_term_length_mo), </span></span>
<span id="cb4-294"><a href="#cb4-294" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            color = "orange",</span></span>
<span id="cb4-295"><a href="#cb4-295" aria-hidden="true" tabindex="-1"></a>  <span class="co">#            alpha = if_else(prob_HI_update_stats$year &gt;= 2022, 0.3, 1)) + #alpha = ((prob_HI_update_stats$year-2012)/(2023-2012))*(1-0.5)+0.5</span></span>
<span id="cb4-296"><a href="#cb4-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste0</span>(year)), <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">nudge_y =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb4-297"><a href="#cb4-297" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_text(aes(label = paste0(janitor::round_half_up(est_prob_term_length_mo, digits = 1))), vjust = 0, nudge_y = 1, color = "gray") +</span></span>
<span id="cb4-298"><a href="#cb4-298" aria-hidden="true" tabindex="-1"></a>  <span class="co"># scale_x_continuous(NULL, limits = c(2012, 2021)) +</span></span>
<span id="cb4-299"><a href="#cb4-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="st">"Estimated Probation Term Length (months)"</span>, <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb4-300"><a href="#cb4-300" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>,<span class="st">"darkorange"</span>, <span class="st">"gold"</span>), <span class="co">#set colors manually</span></span>
<span id="cb4-301"><a href="#cb4-301" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">"CE_BJS_survey"</span>, <span class="st">"CE_2024"</span>, <span class="st">"CX_2024"</span>), <span class="co">#control the order of the labels</span></span>
<span id="cb4-302"><a href="#cb4-302" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Pew Method with old BJS data"</span>, <span class="st">"Pew Method with new CE data"</span>, <span class="st">"Direct method with new CX data"</span>) <span class="co">#customize labels</span></span>
<span id="cb4-303"><a href="#cb4-303" aria-hidden="true" tabindex="-1"></a>                     ) <span class="sc">+</span></span>
<span id="cb4-304"><a href="#cb4-304" aria-hidden="true" tabindex="-1"></a>  <span class="co"># geom_hline(yintercept = 22.4, color = "red", linetype = 2, size = 1) +</span></span>
<span id="cb4-305"><a href="#cb4-305" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">22.4</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-306"><a href="#cb4-306" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="dv">20</span>, <span class="at">vjust =</span> <span class="dv">1</span>, <span class="at">label =</span> <span class="st">"National Avg, 2018</span><span class="sc">\n</span><span class="st">22.4 months"</span>) <span class="sc">+</span></span>
<span id="cb4-307"><a href="#cb4-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2018</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-308"><a href="#cb4-308" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 2017, y = 58.9, hjust = 0, vjust = -.5, label = "HI, 2018\n58.9 months") +</span></span>
<span id="cb4-309"><a href="#cb4-309" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2017</span>, <span class="at">y =</span> <span class="fl">58.9</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span>.<span class="dv">5</span>, <span class="at">label =</span> <span class="st">"58.9 months"</span>) <span class="sc">+</span></span>
<span id="cb4-310"><a href="#cb4-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">x =</span> <span class="dv">2000</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb4-311"><a href="#cb4-311" aria-hidden="true" tabindex="-1"></a>  <span class="co"># annotate(geom = "text", x = 1999, y = 30.7, hjust = 0, vjust = -.5, label = "HI, 2000\n30.7 months") +</span></span>
<span id="cb4-312"><a href="#cb4-312" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">1999</span>, <span class="at">y =</span> <span class="fl">30.7</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">label =</span> <span class="st">"30.7 months"</span>) <span class="sc">+</span></span>
<span id="cb4-313"><a href="#cb4-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb4-314"><a href="#cb4-314" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb4-315"><a href="#cb4-315" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb4-316"><a href="#cb4-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-317"><a href="#cb4-317" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">+</span></span>
<span id="cb4-318"><a href="#cb4-318" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hawaii Probation Term Lengths Across Time"</span>) <span class="sc">+</span></span>
<span id="cb4-319"><a href="#cb4-319" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="probation_term_length_report_2024-05-01_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<p>The direct method with new data and the indirect method with new data yield similar, though not identical, results, both suggesting estimated probation term lengths are lower compared to those estimates using an indirect method with data suffering from data entry lag.</p>
</section>
<section id="limitation-3-the-pew-method-aggregates-felony-and-non-felony-probationers" class="level2" data-number="6">
<h2 data-number="6" class="anchored" data-anchor-id="limitation-3-the-pew-method-aggregates-felony-and-non-felony-probationers"><span class="header-section-number">6</span> Limitation #3: The Pew method aggregates felony and non-felony probationers</h2>
<p>Consider a room filled with 100 government workers and 100 tech industry multi-millionaires The average salary in the room ends up not representing anyone.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="probation_term_length_report_2024-05-01_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The probation term lengths for felony and misdemeanor probationers are like salaries in this example. Felony and misdemeanor probationers are in effect two different sub-populations with distinct distributions for term length, and conceptually, mixing them and taking an average can produce a distorted representation of probation term length. When there are two sub-groups in a dataset, it is often conceptually clearer to disaggregate the data by group and compute separate means for each.</p>
</section>
<section id="fix-3-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data" class="level2" data-number="7">
<h2 data-number="7" class="anchored" data-anchor-id="fix-3-disaggregating-felony-and-non-felony-using-a-direct-method-and-stable-data"><span class="header-section-number">7</span> Fix #3: Disaggregating felony and non-felony using a direct method and stable data</h2>
<p>Disaggregating data by offense severity yields the following results:</p>
<div class="cell">
<details>
<summary>Show the code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Disaggregate Direct method with new CX data by F vs MD/PM----</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#---------------------------------------------------------------------------------#</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#count persons, include negative length terms &lt;- need to be fixed by probation staff</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>prob_data_degree_factors_stats <span class="ot">&lt;-</span> prob_data_clean2 <span class="sc">%&gt;%</span> </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># filter(prob_length_yrs &lt; 20) %&gt;% #exploratory analysis filtering out outliars</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">OffenseDegree_categories =</span> <span class="fu">case_when</span>(OffenseDegree <span class="sc">==</span> <span class="st">"FA"</span> <span class="sc">~</span> <span class="st">"FA"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>                                              OffenseDegree <span class="sc">==</span> <span class="st">"FB"</span> <span class="sc">~</span> <span class="st">"FB"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>                                              OffenseDegree <span class="sc">==</span> <span class="st">"FC"</span> <span class="sc">~</span> <span class="st">"FC"</span>,</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>                                              OffenseDegree <span class="sc">==</span> <span class="st">"MD"</span> <span class="sc">~</span> <span class="st">"MD"</span>,</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>                                              OffenseDegree <span class="sc">==</span> <span class="st">"PM"</span> <span class="sc">~</span> <span class="st">"PM"</span>,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                                              <span class="co"># OffenseDegree %in% c("V", "VL", "") ~ "Other"</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                                              <span class="at">.default =</span> <span class="st">"other"</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>                                              <span class="co"># TRUE ~ "other"</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>                                              ),</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">OffenseDegree_categories =</span> <span class="fu">factor</span>(OffenseDegree_categories, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"FA"</span>,<span class="st">"FB"</span>,<span class="st">"FC"</span>,<span class="st">"MD"</span>,<span class="st">"PM"</span>,<span class="st">"other"</span>)),</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">offense_F_MD =</span> <span class="fu">case_when</span>(OffenseDegree <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"FA"</span>, <span class="st">"FB"</span>, <span class="st">"FC"</span>) <span class="sc">~</span> <span class="st">"Felony"</span>,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                                  OffenseDegree <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"MD"</span>, <span class="st">"PM"</span>) <span class="sc">~</span> <span class="st">"MD-PM"</span>,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">.default =</span> <span class="st">"other"</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>                                  ),</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">offense_F_MD =</span> <span class="fu">factor</span>(offense_F_MD, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Felony"</span>, <span class="st">"MD-PM"</span>, <span class="st">"other"</span>))</span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a><span class="co">#fine df: "FA","FB","FC","MD","PM","other"</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>prob_data_degree_fine_stats <span class="ot">&lt;-</span> prob_data_degree_factors_stats <span class="sc">%&gt;%</span> </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyear, OffenseDegree_categories) <span class="sc">%&gt;%</span> </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_of_probationers =</span> <span class="fu">n</span>(),</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_yr =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T), </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_yr =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_yr =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_mo =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>, </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_mo =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_mo =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>  </span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(mean_yr<span class="sc">:</span>sd_mo, \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>)),</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_probation_term_length =</span> <span class="fu">paste0</span>(mean_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, mean_mo, <span class="st">" months)"</span>),</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">median_probation_term_length =</span> <span class="fu">paste0</span>(median_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, median_mo, <span class="st">" months)"</span>),</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_probation_term_length =</span> <span class="fu">paste0</span>(sd_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, sd_mo, <span class="st">" months)"</span>)</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">year =</span> cyear, OffenseDegree_categories, <span class="at">exits =</span> number_of_probationers, <span class="at">est_prob_term_length_yr =</span> mean_yr, <span class="at">est_prob_term_length_mo =</span> mean_mo) <span class="sc">%&gt;%</span> </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">levels</span>(year))[year])<span class="sc">%&gt;%</span> </span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2012</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a><span class="co">#coarse df: "Felony", "MD-PM", "other"</span></span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>prob_data_degree_coarse_stats <span class="ot">&lt;-</span> prob_data_degree_factors_stats <span class="sc">%&gt;%</span> </span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyear, offense_F_MD) <span class="sc">%&gt;%</span> </span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">number_of_probationers =</span> <span class="fu">n</span>(),</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_yr =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T), </span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_yr =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_yr =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T),</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean_mo =</span> <span class="fu">mean</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>, </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>            <span class="at">median_mo =</span> <span class="fu">median</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span>,</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd_mo =</span> <span class="fu">sd</span>(prob_length_yrs, <span class="at">na.rm =</span> T)<span class="sc">*</span><span class="dv">12</span></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span>  </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(mean_yr<span class="sc">:</span>sd_mo, \(x) <span class="fu">round_half_up</span>(x, <span class="at">digits =</span> <span class="dv">1</span>)),</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>         <span class="at">mean_probation_term_length =</span> <span class="fu">paste0</span>(mean_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, mean_mo, <span class="st">" months)"</span>),</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>         <span class="at">median_probation_term_length =</span> <span class="fu">paste0</span>(median_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, median_mo, <span class="st">" months)"</span>),</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>         <span class="at">sd_probation_term_length =</span> <span class="fu">paste0</span>(sd_yr, <span class="st">" years"</span>, <span class="st">" ("</span>, sd_mo, <span class="st">" months)"</span>)</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="at">year =</span> cyear, offense_F_MD, <span class="at">exits =</span> number_of_probationers, <span class="at">est_prob_term_length_yr =</span> mean_yr, <span class="at">est_prob_term_length_mo =</span> mean_mo) <span class="sc">%&gt;%</span> </span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">levels</span>(year))[year])<span class="sc">%&gt;%</span> </span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(year <span class="sc">&gt;=</span> <span class="dv">2012</span>)</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(prob_data_degree_fine_stats, <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo, <span class="at">color =</span> OffenseDegree_categories)) <span class="sc">+</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> prob_data_degree_coarse_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(offense_F_MD <span class="sc">==</span> <span class="st">"Felony"</span>), <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo, <span class="at">size =</span> exits), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> prob_data_degree_coarse_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(offense_F_MD <span class="sc">==</span> <span class="st">"Felony"</span>), <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> prob_data_degree_coarse_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(offense_F_MD <span class="sc">==</span> <span class="st">"MD-PM"</span>), <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo, <span class="at">size =</span> exits), <span class="at">color =</span> <span class="st">"gray47"</span>) <span class="sc">+</span></span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> prob_data_degree_coarse_stats <span class="sc">%&gt;%</span> <span class="fu">filter</span>(offense_F_MD <span class="sc">==</span> <span class="st">"MD-PM"</span>), <span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> est_prob_term_length_mo), <span class="at">color =</span> <span class="st">"gray47"</span>) <span class="sc">+</span></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">size =</span> exits), <span class="at">pch =</span> <span class="dv">21</span>) <span class="sc">+</span></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Offense Degree"</span>, </span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>                     <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>,<span class="st">"darkorange"</span>, <span class="st">"gold"</span>, <span class="st">"cyan"</span>, <span class="st">"dodgerblue"</span>, <span class="st">"gray90"</span>) <span class="co">#set colors manually</span></span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># breaks = c("CE_BJS_survey", "CE_2024", "CX_2024"), #control the order of the labels</span></span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>                     <span class="co"># labels = c("Pew Method with old BJS data", "Pew Method with new CE data", "Direct method with new CX data") #customize labels</span></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Hawaii Probation Term Lengths Across Time"</span>) <span class="sc">+</span></span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a>  <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="probation_term_length_report_2024-05-01_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="768"></p>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>